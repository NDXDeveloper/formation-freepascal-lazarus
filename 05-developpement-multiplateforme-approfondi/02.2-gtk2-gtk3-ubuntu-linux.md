üîù Retour au [Sommaire](/SOMMAIRE.md)

# 5.2.2 GTK2/GTK3 pour Ubuntu/Linux

## Introduction √† GTK

### Qu'est-ce que GTK ?

**GTK** (GIMP Toolkit) est une biblioth√®que graphique libre et open source, originellement cr√©√©e pour GIMP (GNU Image Manipulation Program). C'est aujourd'hui l'une des principales biblioth√®ques pour cr√©er des interfaces graphiques sous Linux, utilis√©e notamment par l'environnement de bureau GNOME.

**Deux versions principales :**
- **GTK2** (GTK+ 2.x) : Version mature et stable, largement support√©e
- **GTK3** (GTK+ 3.x) : Version moderne avec meilleur support du theming et du HiDPI

### Pourquoi GTK pour Lazarus sur Linux ?

- ‚úì **Standard de facto** sur Ubuntu et distributions GNOME
- ‚úì **Int√©gration native** avec le bureau Linux
- ‚úì **Th√®mes coh√©rents** avec le syst√®me
- ‚úì **Largement disponible** : pr√©install√© sur la plupart des distributions
- ‚úì **Performances optimales** sur Linux
- ‚úì **Support des fonctionnalit√©s modernes** (GTK3)

## Architecture du Widgetset GTK

### Comment GTK s'int√®gre dans Lazarus

```
Votre Code Lazarus
       ‚Üì
  TButton (LCL)
       ‚Üì
TGtk2WSButton / TGtk3WSButton (Widgetset GTK)
       ‚Üì
gtk_button_new() (Biblioth√®que GTK)
       ‚Üì
  Bouton GTK natif
       ‚Üì
  Serveur X11 / Wayland
```

### Diff√©rences entre GTK2 et GTK3

| Aspect | GTK2 | GTK3 |
|--------|------|------|
| **Stabilit√©** | Tr√®s stable, fig√© | En √©volution |
| **Performance** | Excellent | Bon (plus lourd) |
| **Th√®mes** | Syst√®me simple | CSS avanc√© |
| **HiDPI** | Support basique | Support complet |
| **Rendu** | X11 principalement | X11 + Wayland |
| **Compatibilit√©** | Maximum | Moderne |

## Installation et Configuration

### Installer les D√©pendances GTK sur Ubuntu

#### Pour GTK2 :
```bash
# Installer les biblioth√®ques de d√©veloppement GTK2
sudo apt update
sudo apt install libgtk2.0-dev

# V√©rifier l'installation
pkg-config --modversion gtk+-2.0
```

#### Pour GTK3 :
```bash
# Installer les biblioth√®ques de d√©veloppement GTK3
sudo apt update
sudo apt install libgtk-3-dev

# V√©rifier l'installation
pkg-config --modversion gtk+-3.0
```

### Configurer Lazarus pour GTK

#### Dans l'IDE Lazarus

1. **Projet** ‚Üí **Options du projet**
2. **Compilateur** ‚Üí **Ajouts et Substitutions**
3. **LCLWidgetType** ‚Üí S√©lectionner `gtk2` ou `gtk3`

#### En Ligne de Commande

```bash
# Compiler avec GTK2
lazbuild --ws=gtk2 monprojet.lpi

# Compiler avec GTK3
lazbuild --ws=gtk3 monprojet.lpi
```

#### Dans le Code Source

```pascal
program MonApplication;

{$mode objfpc}{$H+}

uses
  {$IFDEF UNIX}
  cthreads,    // IMPORTANT : N√©cessaire pour les threads sur Unix
  {$ENDIF}
  Interfaces,  // Charge le widgetset (GTK2/GTK3 selon configuration)
  Forms,
  Unit1;

begin
  Application.Scaled := True;
  Application.Initialize;
  Application.CreateForm(TForm1, Form1);
  Application.Run;
end.
```

### V√©rifier le Widgetset Actif

```pascal
uses LCLPlatformDef, InterfaceBase;

procedure AfficherInfoGTK;
var
  Version: string;
begin
  case WidgetSet.LCLPlatform of
    lpGtk2:
      begin
        ShowMessage('Utilisation de GTK2');
        // Obtenir la version GTK2
        Version := Format('%d.%d.%d', [
          gtk_major_version,
          gtk_minor_version,
          gtk_micro_version
        ]);
        ShowMessage('Version GTK : ' + Version);
      end;

    lpGtk3:
      begin
        ShowMessage('Utilisation de GTK3');
        // Similaire pour GTK3
      end;
  end;
end;
```

## Fonctionnalit√©s Sp√©cifiques GTK

### 1. Gestion des Th√®mes GTK

```pascal
uses Gtk2, Glib2, Gdk2;  // Pour GTK2
// ou Gtk3, Glib, Gdk3;  // Pour GTK3

// Obtenir le th√®me actuel
function ObtenirThemeActuel: string;
var
  Settings: PGtkSettings;
  ThemeName: PGChar;
begin
  Settings := gtk_settings_get_default();
  g_object_get(Settings, 'gtk-theme-name', [@ThemeName, nil]);
  Result := string(ThemeName);
  g_free(ThemeName);
end;

// Changer le th√®me de l'application
procedure ChangerTheme(const NomTheme: string);
var
  Settings: PGtkSettings;
begin
  Settings := gtk_settings_get_default();
  gtk_settings_set_string_property(Settings, 'gtk-theme-name',
                                   PChar(NomTheme), 'MonApp');
end;

// Appliquer du CSS personnalis√© (GTK3)
{$IFDEF LCLGtk3}
procedure AppliquerCSS;
var
  Provider: PGtkCssProvider;
  Display: PGdkDisplay;
  Screen: PGdkScreen;
  CSS: string;
begin
  CSS := '.button { background-color: #4CAF50; color: white; }' +
         '.button:hover { background-color: #45a049; }';

  Provider := gtk_css_provider_new();
  gtk_css_provider_load_from_data(Provider, PChar(CSS), -1, nil);

  Display := gdk_display_get_default();
  Screen := gdk_display_get_default_screen(Display);

  gtk_style_context_add_provider_for_screen(Screen,
    GTK_STYLE_PROVIDER(Provider),
    GTK_STYLE_PROVIDER_PRIORITY_APPLICATION);

  g_object_unref(Provider);
end;
{$ENDIF}
```

### 2. Ic√¥nes et Images avec GTK

```pascal
// Charger une ic√¥ne du th√®me syst√®me
procedure ChargerIconeTheme(const NomIcone: string);
var
  Theme: PGtkIconTheme;
  Pixbuf: PGdkPixbuf;
  Error: PGError;
begin
  Theme := gtk_icon_theme_get_default();

  // Charger une ic√¥ne standard (48x48 pixels)
  Pixbuf := gtk_icon_theme_load_icon(Theme, PChar(NomIcone), 48,
                                     GTK_ICON_LOOKUP_USE_BUILTIN, @Error);

  if Pixbuf <> nil then
  begin
    // Utiliser le pixbuf avec un TImage
    Image1.Picture.Pixmap.Handle := HBITMAP(Pixbuf);
    g_object_unref(Pixbuf);
  end;
end;

// Exemples d'ic√¥nes standard GTK
procedure ChargerIconesStandard;
begin
  ChargerIconeTheme('document-open');     // Ic√¥ne Ouvrir
  ChargerIconeTheme('document-save');     // Ic√¥ne Sauvegarder
  ChargerIconeTheme('edit-copy');         // Ic√¥ne Copier
  ChargerIconeTheme('edit-paste');        // Ic√¥ne Coller
  ChargerIconeTheme('application-exit');  // Ic√¥ne Quitter
end;
```

### 3. Bo√Ætes de Dialogue GTK Natives

```pascal
// Dialogue de s√©lection de fichier avec aper√ßu
type
  TForm1 = class(TForm)
    procedure AjouterApercuDialogue(Dialog: TOpenDialog);
  end;

procedure TForm1.AjouterApercuDialogue(Dialog: TOpenDialog);
var
  Preview: TImage;
begin
  // Cr√©er un widget d'aper√ßu
  Preview := TImage.Create(nil);
  Preview.Width := 200;
  Preview.Height := 200;
  Preview.Stretch := True;

  // L'ajouter au dialogue (sp√©cifique GTK)
  {$IFDEF LCLGtk2}
  if Dialog.Handle <> 0 then
  begin
    gtk_file_chooser_set_preview_widget(PGtkFileChooser(Dialog.Handle),
                                        PGtkWidget(Preview.Handle));
    gtk_file_chooser_set_preview_widget_active(PGtkFileChooser(Dialog.Handle),
                                               True);
  end;
  {$ENDIF}
end;

// Utiliser un dialogue natif GTK
procedure OuvrirFichierGTK;
var
  Dialog: PGtkWidget;
  Response: gint;
  Filename: PChar;
begin
  Dialog := gtk_file_chooser_dialog_new(
    'Ouvrir un fichier',
    nil,
    GTK_FILE_CHOOSER_ACTION_OPEN,
    'gtk-cancel', GTK_RESPONSE_CANCEL,
    'gtk-open', GTK_RESPONSE_ACCEPT,
    nil);

  // Ajouter des filtres
  var Filter := gtk_file_filter_new();
  gtk_file_filter_set_name(Filter, 'Fichiers texte');
  gtk_file_filter_add_pattern(Filter, '*.txt');
  gtk_file_chooser_add_filter(PGtkFileChooser(Dialog), Filter);

  Response := gtk_dialog_run(GTK_DIALOG(Dialog));
  if Response = GTK_RESPONSE_ACCEPT then
  begin
    Filename := gtk_file_chooser_get_filename(PGtkFileChooser(Dialog));
    ShowMessage('Fichier s√©lectionn√© : ' + string(Filename));
    g_free(Filename);
  end;

  gtk_widget_destroy(Dialog);
end;
```

### 4. Notifications Desktop avec libnotify

```pascal
// Afficher une notification syst√®me Ubuntu/GNOME
procedure AfficherNotification(const Titre, Message: string);
var
  Process: TProcess;
begin
  Process := TProcess.Create(nil);
  try
    Process.Executable := 'notify-send';
    Process.Parameters.Add(Titre);
    Process.Parameters.Add(Message);

    // Options suppl√©mentaires
    Process.Parameters.Add('-i');
    Process.Parameters.Add('dialog-information'); // Ic√¥ne
    Process.Parameters.Add('-t');
    Process.Parameters.Add('5000'); // Dur√©e en ms

    Process.Options := [poNoConsole];
    Process.Execute;
  finally
    Process.Free;
  end;
end;

// Version avec urgence et cat√©gorie
procedure NotificationAvancee(const Titre, Message: string;
                              Urgence: string = 'normal');
var
  Process: TProcess;
begin
  Process := TProcess.Create(nil);
  try
    Process.Executable := 'notify-send';
    Process.Parameters.Add('-u');
    Process.Parameters.Add(Urgence); // 'low', 'normal', 'critical'
    Process.Parameters.Add('-c');
    Process.Parameters.Add('im.received'); // Cat√©gorie
    Process.Parameters.Add(Titre);
    Process.Parameters.Add(Message);

    Process.Execute;
  finally
    Process.Free;
  end;
end;
```

### 5. Int√©gration avec le Bureau GNOME/Unity

```pascal
// Indicateur d'application (App Indicator)
uses Process;

procedure CreerIndicateurApplication;
var
  Script: TStringList;
begin
  // Cr√©er un script Python pour l'indicateur
  Script := TStringList.Create;
  try
    Script.Add('#!/usr/bin/env python3');
    Script.Add('import gi');
    Script.Add('gi.require_version(''AppIndicator3'', ''0.1'')');
    Script.Add('from gi.repository import AppIndicator3, Gtk');
    Script.Add('');
    Script.Add('indicator = AppIndicator3.Indicator.new(');
    Script.Add('  "mon-app-indicator",');
    Script.Add('  "indicator-messages",');
    Script.Add('  AppIndicator3.IndicatorCategory.APPLICATION_STATUS)');
    Script.Add('indicator.set_status(AppIndicator3.IndicatorStatus.ACTIVE)');
    Script.Add('');
    Script.Add('menu = Gtk.Menu()');
    Script.Add('item = Gtk.MenuItem(label="Mon Application")');
    Script.Add('menu.append(item)');
    Script.Add('menu.show_all()');
    Script.Add('indicator.set_menu(menu)');
    Script.Add('');
    Script.Add('Gtk.main()');

    Script.SaveToFile('/tmp/indicator.py');

    // Ex√©cuter le script
    with TProcess.Create(nil) do
    try
      Executable := 'python3';
      Parameters.Add('/tmp/indicator.py');
      Options := [poNoConsole];
      Execute;
    finally
      Free;
    end;
  finally
    Script.Free;
  end;
end;

// Barre de progression Unity (Ubuntu)
procedure MettreAJourProgressionUnity(Valeur: Integer);
var
  Process: TProcess;
begin
  Process := TProcess.Create(nil);
  try
    Process.Executable := 'gdbus';
    Process.Parameters.Add('call');
    Process.Parameters.Add('--session');
    Process.Parameters.Add('--dest=com.canonical.Unity');
    Process.Parameters.Add('--object-path=/com/canonical/Unity/LauncherEntry/' +
                           IntToStr(Application.Handle));
    Process.Parameters.Add('--method=com.canonical.Unity.LauncherEntry.Update');
    Process.Parameters.Add(Format('{"progress": <double>%f, "progress-visible": <true>}',
                                  [Valeur / 100.0]));

    Process.Options := [poNoConsole, poWaitOnExit];
    Process.Execute;
  finally
    Process.Free;
  end;
end;
```

## Gestion des Signaux GTK

### Connecter des Signaux Personnalis√©s

```pascal
// Type de callback GTK
type
  TGtkSignalFunc = procedure(Widget: PGtkWidget; Data: gpointer); cdecl;

// Callback personnalis√©
procedure MonCallback(Widget: PGtkWidget; Data: gpointer); cdecl;
begin
  ShowMessage('Signal GTK re√ßu!');
end;

// Connecter un signal
procedure ConnecterSignal;
var
  Button: PGtkWidget;
begin
  Button := PGtkWidget(Button1.Handle);

  // Connecter au signal "clicked"
  g_signal_connect(Button, 'clicked', TGCallback(@MonCallback), nil);

  // Connecter avec donn√©es
  g_signal_connect_data(Button, 'button-press-event',
                       TGCallback(@MonCallback),
                       gpointer(Self), nil, 0);
end;

// Bloquer/d√©bloquer les signaux
procedure GererSignaux(Actifs: Boolean);
var
  Widget: PGtkWidget;
begin
  Widget := PGtkWidget(Edit1.Handle);

  if Actifs then
    g_signal_handlers_unblock_by_func(Widget, @MonCallback, nil)
  else
    g_signal_handlers_block_by_func(Widget, @MonCallback, nil);
end;
```

## Dessin Personnalis√© avec Cairo (GTK2/3)

Cairo est la biblioth√®que de dessin vectoriel utilis√©e par GTK :

```pascal
uses Cairo, CairoXlib;

procedure DessinCairo(Canvas: TCanvas);
var
  cr: Pcairo_t;
  surface: Pcairo_surface_t;
begin
  // Cr√©er un contexte Cairo depuis le canvas
  {$IFDEF LCLGtk2}
  cr := gdk_cairo_create(TGtkDeviceContext(Canvas.Handle).Drawable);
  {$ENDIF}

  // Dessiner avec Cairo
  cairo_set_source_rgb(cr, 0.0, 0.0, 1.0); // Bleu
  cairo_set_line_width(cr, 2.0);

  // Dessiner un cercle
  cairo_arc(cr, 100, 100, 50, 0, 2 * PI);
  cairo_stroke(cr);

  // Gradient
  var pattern := cairo_pattern_create_linear(0, 0, 200, 200);
  cairo_pattern_add_color_stop_rgb(pattern, 0, 1, 0, 0); // Rouge
  cairo_pattern_add_color_stop_rgb(pattern, 1, 0, 0, 1); // Bleu
  cairo_set_source(cr, pattern);
  cairo_rectangle(cr, 150, 150, 100, 100);
  cairo_fill(cr);
  cairo_pattern_destroy(pattern);

  // Texte avec Cairo
  cairo_select_font_face(cr, 'Ubuntu',
                         CAIRO_FONT_SLANT_NORMAL,
                         CAIRO_FONT_WEIGHT_BOLD);
  cairo_set_font_size(cr, 20);
  cairo_move_to(cr, 10, 50);
  cairo_show_text(cr, 'Texte Cairo');

  // Lib√©rer
  cairo_destroy(cr);
end;
```

## Optimisations Sp√©cifiques GTK

### 1. R√©duire les Mises √† Jour de l'Interface

```pascal
// Suspendre les mises √† jour lors de modifications massives
procedure ModificationsMassives;
begin
  // Freeze/Thaw pour les widgets GTK
  {$IFDEF LCLGtk2}
  gtk_widget_freeze_child_notify(PGtkWidget(TreeView1.Handle));
  try
    // Ajouter beaucoup de n≈ìuds
    for i := 1 to 10000 do
      TreeView1.Items.Add(nil, 'N≈ìud ' + IntToStr(i));
  finally
    gtk_widget_thaw_child_notify(PGtkWidget(TreeView1.Handle));
  end;
  {$ENDIF}
end;

// Pour les ListBox/ComboBox
procedure OptimiserListBox;
begin
  ListBox1.Items.BeginUpdate;
  try
    ListBox1.Items.Clear;
    for i := 1 to 5000 do
      ListBox1.Items.Add('Item ' + IntToStr(i));
  finally
    ListBox1.Items.EndUpdate;
  end;
end;
```

### 2. Gestion M√©moire GTK

```pascal
// Lib√©rer correctement les ressources GTK
procedure LibererRessourcesGTK;
var
  Pixbuf: PGdkPixbuf;
  List: PGList;
begin
  // Pour les pixbufs
  Pixbuf := gdk_pixbuf_new_from_file(PChar('image.png'), nil);
  if Pixbuf <> nil then
  begin
    // Utiliser le pixbuf
    // ...

    // IMPORTANT : Lib√©rer
    g_object_unref(Pixbuf);
  end;

  // Pour les listes GLib
  List := gtk_container_get_children(PGtkContainer(Panel1.Handle));
  if List <> nil then
  begin
    // Utiliser la liste
    // ...

    // IMPORTANT : Lib√©rer
    g_list_free(List);
  end;
end;
```

### 3. Double Buffering

```pascal
// Activer le double buffering (GTK2)
procedure ActiverDoubleBuffer;
begin
  {$IFDEF LCLGtk2}
  gtk_widget_set_double_buffered(PGtkWidget(Form1.Handle), True);

  // Pour un contr√¥le sp√©cifique
  gtk_widget_set_double_buffered(PGtkWidget(PaintBox1.Handle), True);
  {$ENDIF}

  // GTK3 a le double buffering activ√© par d√©faut
end;
```

## Gestion des Diff√©rences GTK2/GTK3

### Code Conditionnel

```pascal
procedure CodeSpecifiqueVersion;
begin
  {$IFDEF LCLGtk2}
  // Code sp√©cifique GTK2
  ShowMessage('Utilisation de GTK2');

  // Fonctions d√©pr√©ci√©es dans GTK3
  gtk_widget_set_uposition(PGtkWidget(Button1.Handle), 10, 10);
  {$ENDIF}

  {$IFDEF LCLGtk3}
  // Code sp√©cifique GTK3
  ShowMessage('Utilisation de GTK3');

  // Nouvelles fonctions GTK3
  gtk_widget_set_margin_start(PGtkWidget(Button1.Handle), 10);
  gtk_widget_set_margin_top(PGtkWidget(Button1.Handle), 10);
  {$ENDIF}
end;
```

### Tableau de Correspondance

| Fonction GTK2 | √âquivalent GTK3 |
|--------------|-----------------|
| `gtk_widget_set_uposition` | `gtk_widget_set_margin_*` |
| `gtk_widget_modify_bg` | CSS avec `gtk_css_provider` |
| `gdk_drawable_get_size` | `gtk_widget_get_allocated_width/height` |
| `gtk_dialog_set_has_separator` | Supprim√© (pas de s√©parateur) |

## D√©bogage d'Applications GTK

### Variables d'Environnement Utiles

```bash
# Activer le d√©bogage GTK
export GTK_DEBUG=all

# Th√®me de d√©bogage
export GTK_THEME=Adwaita:dark

# Forcer l'utilisation de X11 (pas Wayland)
export GDK_BACKEND=x11

# D√©bogage des modules
export GTK_MODULES=gail:atk-bridge

# Lancer l'application avec d√©bogage
GTK_DEBUG=interactive ./monapplication
```

### Utiliser l'Inspecteur GTK (GTK3)

```pascal
// Activer l'inspecteur GTK3 par programmation
procedure ActiverInspecteur;
begin
  {$IFDEF LCLGtk3}
  // Ctrl+Shift+D ouvrira l'inspecteur
  gtk_window_set_interactive_debugging(True);
  {$ENDIF}
end;
```

## Probl√®mes Courants et Solutions

### 1. Probl√®me : Application qui ne d√©marre pas

**Solution :**
```bash
# V√©rifier les d√©pendances
ldd ./monapplication | grep "not found"

# Installer les biblioth√®ques manquantes
sudo apt install libgtk2.0-0  # Pour GTK2
sudo apt install libgtk-3-0   # Pour GTK3
```

### 2. Probl√®me : Th√®me incorrect ou moche

**Solution :**
```pascal
// Forcer un th√®me sp√©cifique
procedure ForceTheme;
var
  Settings: PGtkSettings;
begin
  Settings := gtk_settings_get_default();
  g_object_set(Settings, 'gtk-theme-name', PChar('Adwaita'), nil);
  g_object_set(Settings, 'gtk-icon-theme-name', PChar('Adwaita'), nil);
end;
```

### 3. Probl√®me : Caract√®res sp√©ciaux mal affich√©s

**Solution :**
```pascal
// Assurer l'encodage UTF-8
function ConvertirUTF8(const S: string): string;
begin
  Result := UTF8Encode(S);
end;

// Utilisation
Button1.Caption := ConvertirUTF8('Caf√© √† 3‚Ç¨');
```

### 4. Probl√®me : Scintillement lors du redimensionnement

**Solution :**
```pascal
procedure ReduceFlicker;
begin
  {$IFDEF LCLGtk2}
  // Activer le double buffering
  gtk_widget_set_double_buffered(PGtkWidget(Form1.Handle), True);

  // Optimiser les √©v√©nements de redimensionnement
  g_object_set(PGtkWidget(Form1.Handle),
               'resize-mode', GTK_RESIZE_QUEUE, nil);
  {$ENDIF}
end;
```

## D√©ploiement d'Applications GTK

### Cr√©er un Paquet DEB pour Ubuntu

```bash
# Structure du paquet
myapp/
‚îú‚îÄ‚îÄ DEBIAN/
‚îÇ   ‚îî‚îÄ‚îÄ control
‚îú‚îÄ‚îÄ usr/
‚îÇ   ‚îú‚îÄ‚îÄ bin/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ myapp
‚îÇ   ‚îî‚îÄ‚îÄ share/
‚îÇ       ‚îú‚îÄ‚îÄ applications/
‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ myapp.desktop
‚îÇ       ‚îî‚îÄ‚îÄ icons/
‚îÇ           ‚îî‚îÄ‚îÄ myapp.png

# Fichier control
Package: myapp
Version: 1.0
Architecture: amd64
Maintainer: Votre Nom <email@example.com>
Depends: libgtk2.0-0 (>= 2.24) | libgtk-3-0 (>= 3.22)
Description: Mon Application GTK
 Description d√©taill√©e de l'application

# Cr√©er le paquet
dpkg-deb --build myapp myapp_1.0_amd64.deb
```

### Fichier Desktop pour l'Int√©gration

```ini
[Desktop Entry]
Name=Mon Application
Comment=Description de mon application
Exec=/usr/bin/myapp
Icon=myapp
Terminal=false
Type=Application
Categories=Utility;Development;
```

### Script de Lancement

```bash
#!/bin/bash
# Lancer avec les bonnes variables d'environnement

# D√©finir le th√®me si n√©cessaire
export GTK_THEME=Adwaita

# D√©finir la locale
export LANG=fr_FR.UTF-8

# Lancer l'application
exec /usr/bin/myapp "$@"
```

## Bonnes Pratiques GTK

### 1. Respecter les Guidelines GNOME HIG

```pascal
// Espacement standard GNOME
const
  GNOME_SPACING = 6;
  GNOME_BORDER = 12;

procedure AppliquerEspacement;
begin
  Form1.BorderSpacing.Around := GNOME_BORDER;
  Panel1.BorderSpacing.InnerBorder := GNOME_SPACING;
end;
```

### 2. Utiliser les Ic√¥nes du Th√®me

```pascal
// Toujours utiliser les noms d'ic√¥nes standard
procedure DefinirIconesStandard;
begin
  btnOpen.Glyph.LoadFromIconTheme('document-open');
  btnSave.Glyph.LoadFromIconTheme('document-save');
  btnCopy.Glyph.LoadFromIconTheme('edit-copy');
  btnPaste.Glyph.LoadFromIconTheme('edit-paste');
end;
```

### 3. G√©rer les DPI Variables

```pascal
// Adapter √† la densit√© d'√©cran
function GetScaleFactor: Double;
var
  Screen: PGdkScreen;
begin
  {$IFDEF LCLGtk2}
  Screen := gdk_screen_get_default();
  Result := gdk_screen_get_resolution(Screen) / 96.0;
  {$ELSE}
  Result := 1.0;
  {$ENDIF}
end;

procedure AdapterDPI;
var
  Scale: Double;
begin
  Scale := GetScaleFactor;
  Form1.Font.Size := Round(9 * Scale);
end;
```

## Conclusion

Les widgetsets GTK2 et GTK3 offrent une excellente int√©gration avec les environnements de bureau Linux, particuli√®rement Ubuntu et GNOME.

**Points cl√©s √† retenir :**
- **GTK2** pour la stabilit√© et la compatibilit√© maximale
- **GTK3** pour les fonctionnalit√©s modernes et le meilleur support HiDPI
- Toujours tester sur la version GTK cible
- Respecter les conventions d'interface GNOME/Ubuntu
- Utiliser les fonctionnalit√©s natives (th√®mes, notifications, etc.)

En ma√Ætrisant GTK avec Lazarus, vous cr√©ez des applications Linux qui s'int√®grent parfaitement au bureau, tout en conservant la portabilit√© du code Lazarus.

‚è≠Ô∏è [Qt5 comme alternative universelle](/05-developpement-multiplateforme-approfondi/02.3-qt5-alternative-universelle.md)
