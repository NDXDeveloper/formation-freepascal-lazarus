üîù Retour au [Sommaire](/SOMMAIRE.md)

# 13.7 Raspberry Pi

## Introduction

Le **Raspberry Pi** est un nano-ordinateur monocartes (single-board computer) cr√©√© par la Fondation Raspberry Pi au Royaume-Uni. Depuis son lancement en 2012, il est devenu une plateforme incontournable pour l'apprentissage de la programmation, les projets embarqu√©s, l'IoT (Internet des Objets) et le prototypage rapide.

**FreePascal et Lazarus** offrent un excellent support pour le Raspberry Pi, permettant de d√©velopper des applications performantes sur cette plateforme ARM avec le confort d'un langage structur√© et d'un IDE moderne.

## Pourquoi utiliser FreePascal sur Raspberry Pi ?

### Avantages de FreePascal pour le Raspberry Pi

- **Performances natives** : Code compil√© directement pour ARM, pas d'interpr√©teur
- **Faible consommation de ressources** : Id√©al pour les capacit√©s limit√©es du Raspberry Pi
- **Portabilit√©** : Le m√™me code fonctionne sur Windows, Linux x86 et ARM
- **Pas de runtime lourd** : Contrairement √† Java ou .NET
- **Acc√®s direct au mat√©riel** : GPIO, I2C, SPI, etc.
- **Syntaxe claire et lisible** : Parfait pour l'apprentissage et les projets √©ducatifs
- **Biblioth√®ques disponibles** : Acc√®s aux biblioth√®ques Linux standard

### Cas d'usage typiques

- **Domotique** : Contr√¥le de syst√®mes de maison intelligente
- **Stations m√©t√©o** : Collecte et affichage de donn√©es environnementales
- **Syst√®mes embarqu√©s** : Contr√¥le de robots, drones, machines
- **Serveurs l√©gers** : Web, FTP, bases de donn√©es
- **Affichage d'information** : Panneaux d'information, kiosques
- **IoT et capteurs** : Collecte et transmission de donn√©es
- **Apprentissage** : Enseignement de la programmation syst√®me

## Les mod√®les de Raspberry Pi

### Comparaison des mod√®les r√©cents

| Mod√®le | CPU | RAM | Prix | Usage typique |
|--------|-----|-----|------|---------------|
| **Pi Zero 2 W** | ARM Cortex-A53 (4 c≈ìurs, 1 GHz) | 512 MB | ~15‚Ç¨ | Projets ultra-compacts |
| **Pi 4 Model B** | ARM Cortex-A72 (4 c≈ìurs, 1.5 GHz) | 2/4/8 GB | 35-75‚Ç¨ | Usage g√©n√©ral, serveur |
| **Pi 5** | ARM Cortex-A76 (4 c≈ìurs, 2.4 GHz) | 4/8 GB | 60-80‚Ç¨ | Performances maximales |
| **Pi 400** | ARM Cortex-A72 (4 c≈ìurs, 1.8 GHz) | 4 GB | ~70‚Ç¨ | Ordinateur clavier int√©gr√© |

### Architecture ARM et FreePascal

Les Raspberry Pi utilisent des processeurs **ARM** avec diff√©rentes architectures :

- **ARMv6** : Raspberry Pi 1, Zero (FPC : `-Parm`)
- **ARMv7** : Raspberry Pi 2, 3 (32 bits) (FPC : `-Parmv7`)
- **ARMv8/AArch64** : Raspberry Pi 3, 4, 5 (64 bits) (FPC : `-Paarch64`)

FreePascal supporte nativement toutes ces architectures ARM.

## Syst√®mes d'exploitation compatibles

### Raspberry Pi OS (recommand√©)

Anciennement appel√© **Raspbian**, c'est le syst√®me officiel bas√© sur Debian :

```bash
# Versions disponibles
- Raspberry Pi OS (32 bits) : Pour tous les mod√®les
- Raspberry Pi OS (64 bits) : Pour Pi 3, 4, 5 uniquement
- Raspberry Pi OS Lite : Version sans interface graphique (headless)
```

**Avantages** :
- Optimis√© pour le Raspberry Pi
- Support mat√©riel complet
- Grande communaut√©
- Packages pr√©-configur√©s

### Ubuntu pour Raspberry Pi

Ubuntu propose des versions officielles pour Raspberry Pi :

```bash
# Versions disponibles
- Ubuntu Server (64 bits)
- Ubuntu Desktop (64 bits)
```

**Avantages** :
- √âcosyst√®me Ubuntu familier
- Support LTS (Long Term Support)
- Packages Ubuntu standards

### Autres syst√®mes

- **DietPi** : Syst√®me ultra-l√©ger et optimis√©
- **LibreELEC** : Pour centre multim√©dia
- **RetroPie** : Pour √©mulation de jeux r√©tro
- **Arch Linux ARM** : Pour utilisateurs avanc√©s

> üí° **Recommandation** : Pour d√©buter avec FreePascal, utilisez **Raspberry Pi OS (64 bits)** sur un Raspberry Pi 4 ou 5.

## Installation de FreePascal sur Raspberry Pi

### M√©thode 1 : Installation depuis les d√©p√¥ts (la plus simple)

```bash
# Mise √† jour du syst√®me
sudo apt update
sudo apt upgrade

# Installation de FreePascal et Lazarus
sudo apt install fpc lazarus

# V√©rification de l'installation
fpc -version
```

Cette m√©thode installe g√©n√©ralement une version l√©g√®rement ancienne mais stable.

**Version typique install√©e** : FPC 3.2.0 ou 3.2.2

### M√©thode 2 : Installation via FpcUpDeluxe

Pour obtenir la derni√®re version de FreePascal et Lazarus :

```bash
# T√©l√©charger FpcUpDeluxe
wget https://github.com/LongDirtyAnimAlf/fpcupdeluxe/releases/download/1.8.2/fpcupdeluxe-arm-linux
chmod +x fpcupdeluxe-arm-linux

# Lancer FpcUpDeluxe
./fpcupdeluxe-arm-linux
```

FpcUpDeluxe t√©l√©charge et compile automatiquement les derni√®res versions de FPC et Lazarus.

### M√©thode 3 : Compilation depuis les sources

Pour les utilisateurs avanc√©s ou pour des besoins sp√©cifiques :

```bash
# Installation des d√©pendances
sudo apt install build-essential subversion

# T√©l√©chargement des sources FPC
svn checkout https://svn.freepascal.org/svn/fpc/tags/release_3_2_2 fpc-3.2.2
cd fpc-3.2.2

# Compilation
make clean
make all
sudo make install

# Configuration
sudo ln -sf /usr/local/lib/fpc/3.2.2/ppcarm /usr/local/bin/ppcarm
```

> ‚ö†Ô∏è **Note** : La compilation peut prendre de 30 minutes √† plusieurs heures selon le mod√®le de Raspberry Pi.

## Configuration de l'environnement

### Variables d'environnement

Ajoutez ces lignes √† votre `~/.bashrc` :

```bash
# FreePascal
export PATH=$PATH:/usr/local/lib/fpc/3.2.2

# Configuration du compilateur
export FPC=/usr/local/bin/fpc

# Librairies
export FPCDIR=/usr/local/lib/fpc/3.2.2
```

Puis rechargez la configuration :

```bash
source ~/.bashrc
```

### Configuration de Lazarus pour Raspberry Pi

Si vous utilisez Lazarus avec interface graphique (uniquement sur Raspberry Pi OS Desktop) :

1. **Lancer Lazarus** :
   ```bash
   lazarus-ide
   ```

2. **Configurer le compilateur** :
   - Menu `Outils` ‚Üí `Options`
   - Section `Compilateur FreePascal`
   - V√©rifier le chemin vers `fpc`

3. **Configurer le d√©bogueur** :
   - Menu `Outils` ‚Üí `Options`
   - Section `D√©bogueur`
   - S√©lectionner `GNU debugger (gdb)`

## Premier programme sur Raspberry Pi

### Programme console simple

Cr√©ez un fichier `hello_rpi.pas` :

```pascal
program HelloRaspberryPi;

{$mode objfpc}{$H+}

uses
  SysUtils;

begin
  WriteLn('=================================');
  WriteLn('  Bonjour depuis Raspberry Pi!   ');
  WriteLn('=================================');
  WriteLn;
  WriteLn('Architecture : ', {$I %FPCTARGET%});
  WriteLn('Syst√®me      : ', {$I %FPCTARGETOS%});
  WriteLn('Date         : ', DateTimeToStr(Now));
  WriteLn('Utilisateur  : ', GetEnvironmentVariable('USER'));
  WriteLn;
end.
```

### Compilation et ex√©cution

```bash
# Compilation
fpc hello_rpi.pas

# Ex√©cution
./hello_rpi
```

**Sortie attendue** :
```
=================================
  Bonjour depuis Raspberry Pi!
=================================

Architecture : aarch64-linux
Syst√®me      : linux
Date         : 03/10/2025 14:30:00
Utilisateur  : pi
```

## Acc√®s aux ressources syst√®me

### Informations mat√©rielles

```pascal
program SystemInfo;

{$mode objfpc}{$H+}

uses
  SysUtils, Process;

function ExecuteCommand(const cmd: string): string;
var
  process: TProcess;
  outputList: TStringList;
begin
  Result := '';
  process := TProcess.Create(nil);
  outputList := TStringList.Create;
  try
    process.CommandLine := cmd;
    process.Options := process.Options + [poWaitOnExit, poUsePipes];
    process.Execute;
    outputList.LoadFromStream(process.Output);
    Result := outputList.Text;
  finally
    outputList.Free;
    process.Free;
  end;
end;

begin
  WriteLn('===== Informations Syst√®me Raspberry Pi =====');
  WriteLn;

  WriteLn('Mod√®le:');
  Write(ExecuteCommand('cat /proc/device-tree/model'));
  WriteLn;

  WriteLn('CPU:');
  Write(ExecuteCommand('lscpu | grep "Model name"'));
  WriteLn;

  WriteLn('M√©moire:');
  Write(ExecuteCommand('free -h | grep Mem'));
  WriteLn;

  WriteLn('Temp√©rature CPU:');
  Write(ExecuteCommand('vcgencmd measure_temp'));
  WriteLn;

  WriteLn('Stockage:');
  Write(ExecuteCommand('df -h | grep root'));
end.
```

### Lecture de la temp√©rature du CPU

```pascal
program CPUTemperature;

{$mode objfpc}{$H+}

uses
  SysUtils, Classes;

function GetCPUTemp: Double;
var
  tempFile: TextFile;
  tempStr: string;
  tempValue: Integer;
begin
  Result := 0.0;
  if FileExists('/sys/class/thermal/thermal_zone0/temp') then
  begin
    AssignFile(tempFile, '/sys/class/thermal/thermal_zone0/temp');
    Reset(tempFile);
    try
      ReadLn(tempFile, tempStr);
      tempValue := StrToIntDef(tempStr, 0);
      Result := tempValue / 1000.0; // Conversion en degr√©s Celsius
    finally
      CloseFile(tempFile);
    end;
  end;
end;

begin
  WriteLn('Temp√©rature CPU: ', GetCPUTemp:0:1, '¬∞C');

  // Surveillance continue
  Write('Surveillance continue (Ctrl+C pour arr√™ter)...');
  WriteLn;
  repeat
    Write(#13, 'Temp√©rature: ', GetCPUTemp:0:1, '¬∞C  ');
    Sleep(1000); // Attendre 1 seconde
  until False;
end.
```

## Interface graphique sur Raspberry Pi

### Application LCL simple

Cr√©ez une application graphique l√©g√®re avec Lazarus :

```pascal
program SimpleGUI;

{$mode objfpc}{$H+}

uses
  {$IFDEF UNIX}
  cthreads,
  {$ENDIF}
  Interfaces, // LCL widgetset
  Forms, Controls, StdCtrls, ExtCtrls;

type
  TMainForm = class(TForm)
    InfoLabel: TLabel;
    TempLabel: TLabel;
    Timer: TTimer;
    procedure FormCreate(Sender: TObject);
    procedure TimerTimer(Sender: TObject);
  private
    function GetCPUTemp: Double;
  end;

var
  MainForm: TMainForm;

procedure TMainForm.FormCreate(Sender: TObject);
begin
  Caption := 'Raspberry Pi - FreePascal';
  Width := 400;
  Height := 200;
  Position := poScreenCenter;

  InfoLabel := TLabel.Create(Self);
  InfoLabel.Parent := Self;
  InfoLabel.Caption := 'Surveillance Raspberry Pi';
  InfoLabel.Left := 20;
  InfoLabel.Top := 20;
  InfoLabel.Font.Size := 14;

  TempLabel := TLabel.Create(Self);
  TempLabel.Parent := Self;
  TempLabel.Caption := 'Temp√©rature: --¬∞C';
  TempLabel.Left := 20;
  TempLabel.Top := 60;
  TempLabel.Font.Size := 12;

  Timer := TTimer.Create(Self);
  Timer.Interval := 1000;
  Timer.OnTimer := @TimerTimer;
  Timer.Enabled := True;
end;

function TMainForm.GetCPUTemp: Double;
var
  tempFile: TextFile;
  tempStr: string;
begin
  Result := 0.0;
  if FileExists('/sys/class/thermal/thermal_zone0/temp') then
  begin
    AssignFile(tempFile, '/sys/class/thermal/thermal_zone0/temp');
    Reset(tempFile);
    try
      ReadLn(tempFile, tempStr);
      Result := StrToInt(tempStr) / 1000.0;
    finally
      CloseFile(tempFile);
    end;
  end;
end;

procedure TMainForm.TimerTimer(Sender: TObject);
begin
  TempLabel.Caption := Format('Temp√©rature: %.1f¬∞C', [GetCPUTemp]);
end;

begin
  Application.Initialize;
  Application.CreateForm(TMainForm, MainForm);
  Application.Run;
end.
```

### Compilation de l'application graphique

```bash
# Compiler avec support LCL
lazbuild --build-mode=Release SimpleGUI.lpi

# Ou avec fpc directement (plus complexe)
fpc -Fu/usr/lib/lazarus/lcl/units/arm-linux \
    -Fu/usr/lib/lazarus/lcl/units/arm-linux/gtk2 \
    SimpleGUI.pas
```

## Optimisation pour Raspberry Pi

### Options de compilation recommand√©es

```bash
# Pour Raspberry Pi 3/4/5 (ARMv7/ARMv8)
fpc -O3 -CpARMV7A -CfVFPV3 monprogramme.pas

# Pour optimisation maximale
fpc -O4 -OoFASTMATH -CpARMV7A -CfVFPV3 monprogramme.pas
```

**Explications des options** :
- `-O3` ou `-O4` : Niveau d'optimisation (3 = √©lev√©, 4 = maximum)
- `-CpARMV7A` : Cibler l'architecture ARMv7-A
- `-CfVFPV3` : Utiliser les instructions VFP (Floating Point) version 3
- `-OoFASTMATH` : Optimisations math√©matiques agressives

### Fichier de configuration projet

Cr√©ez un fichier `fpc.cfg` dans votre projet :

```ini
# Configuration pour Raspberry Pi optimis√©

# Architecture ARM
-CpARMV7A
-CfVFPV3

# Optimisations
-O3
-OoREGVAR
-OoSTACKFRAME
-OoPEEPHOLE

# Options de link
-Xs
-XX

# Debugging (√† commenter pour la production)
#-g
#-gl

# Chemins des unit√©s
-Fu/usr/lib/fpc/$fpcversion/units/$fpctarget
-Fu/usr/lib/lazarus/lcl/units/$fpctarget
```

## Acc√®s distant et d√©veloppement headless

### SSH (Secure Shell)

Activer SSH sur le Raspberry Pi :

```bash
# Sur le Raspberry Pi
sudo raspi-config
# Aller dans "Interface Options" ‚Üí "SSH" ‚Üí "Enable"

# Ou directement
sudo systemctl enable ssh
sudo systemctl start ssh
```

Se connecter depuis un autre ordinateur :

```bash
# Depuis Windows, Linux ou macOS
ssh pi@raspberrypi.local
# Mot de passe par d√©faut : raspberry (√† changer!)
```

### Transfert de fichiers avec SCP

```bash
# Envoyer un fichier vers le Raspberry Pi
scp monprogramme.pas pi@raspberrypi.local:/home/pi/

# R√©cup√©rer un fichier depuis le Raspberry Pi
scp pi@raspberrypi.local:/home/pi/resultat.txt ./
```

### D√©veloppement avec VS Code Remote

Visual Studio Code peut se connecter au Raspberry Pi via SSH :

1. Installer l'extension **Remote - SSH**
2. Se connecter au Raspberry Pi
3. √âditer et compiler directement sur le Pi

### Montage r√©seau (SSHFS)

Monter le syst√®me de fichiers du Raspberry Pi sur votre PC :

```bash
# Sur Ubuntu/Linux
sudo apt install sshfs
mkdir ~/raspberry
sshfs pi@raspberrypi.local:/home/pi ~/raspberry

# Sur Windows (avec WinFsp + SSHFS-Win)
# Utiliser l'interface graphique ou la commande
net use R: \\sshfs\pi@raspberrypi.local
```

## Gestion de l'alimentation et performances

### Surveillance de la consommation

```pascal
program PowerMonitor;

{$mode objfpc}{$H+}

uses
  SysUtils;

function GetThrottleStatus: string;
var
  cmd: string;
begin
  // Commande vcgencmd pour lire l'√©tat de throttling
  cmd := 'vcgencmd get_throttled';
  // Impl√©mentation simplifi√©e
  Result := 'Voir documentation vcgencmd';
end;

function GetVoltage: string;
var
  cmd: string;
begin
  cmd := 'vcgencmd measure_volts';
  Result := 'Voir documentation vcgencmd';
end;

begin
  WriteLn('√âtat du syst√®me:');
  WriteLn('  Throttle: ', GetThrottleStatus);
  WriteLn('  Voltage : ', GetVoltage);
end.
```

### Overclocking (avanc√©)

Modifier `/boot/config.txt` pour overclocker (√† vos risques) :

```ini
# Exemple pour Raspberry Pi 4
over_voltage=6
arm_freq=2000
```

> ‚ö†Ô∏è **Attention** : L'overclocking peut r√©duire la dur√©e de vie du Raspberry Pi et n√©cessite un refroidissement ad√©quat.

## Ressources et documentation

### Documentation officielle

- **Site officiel Raspberry Pi** : https://www.raspberrypi.com/
- **Documentation Raspberry Pi** : https://www.raspberrypi.com/documentation/
- **Forum Raspberry Pi** : https://forums.raspberrypi.com/

### FreePascal sur ARM

- **Wiki FreePascal ARM** : https://wiki.freepascal.org/ARM_Linux
- **Forum FreePascal** : https://forum.lazarus.freepascal.org/
- **Documentation FPC** : https://www.freepascal.org/docs.html

### Communaut√© francophone

- **Forum Lazarus francophone** : https://forum.lazarus.freepascal.org/index.php/board,8.0.html
- **Developpez.com Pascal** : Forums et tutoriels en fran√ßais
- **Discord/Telegram FreePascal FR** : Communaut√©s actives

## Limitations et consid√©rations

### Limitations mat√©rielles

- **RAM limit√©e** : 512 MB √† 8 GB selon le mod√®le (attention aux fuites m√©moire)
- **CPU modeste** : Projets lourds peuvent √™tre lents
- **Stockage SD** : Plus lent qu'un SSD, usure possible
- **Pas de GPU puissant** : Graphiques 3D complexes limit√©s
- **Refroidissement** : Throttling si temp√©rature √©lev√©e

### Bonnes pratiques

1. **Optimiser le code** : Utiliser les options de compilation appropri√©es
2. **Lib√©rer la m√©moire** : Attention aux objets et structures dynamiques
3. **√âviter les boucles infinies** : Consommation CPU inutile
4. **Utiliser des threads avec parcimonie** : Capacit√©s limit√©es
5. **Surveiller la temp√©rature** : Utiliser un dissipateur thermique
6. **Alimentation stable** : Utiliser une alimentation de qualit√© (3A minimum pour Pi 4)

## Prochaines √©tapes

Dans les sections suivantes, nous verrons :

- **13.7.1 Cross-compilation depuis Windows** : Compiler sur PC pour Raspberry Pi
- **13.7.2 D√©veloppement natif sur Ubuntu ARM** : D√©velopper directement sur le Pi

---

## Conclusion de l'introduction

Le **Raspberry Pi** est une excellente plateforme pour d√©velopper avec **FreePascal** des applications embarqu√©es, des syst√®mes IoT et des projets √©ducatifs. Avec un support ARM mature, des performances natives et une consommation de ressources minimale, FreePascal est un choix judicieux pour le d√©veloppement sur Raspberry Pi.

Que vous d√©veloppiez directement sur le Raspberry Pi ou que vous utilisiez la cross-compilation depuis Windows ou Linux, FreePascal vous offre tous les outils n√©cessaires pour cr√©er des applications performantes et portables.

> üí° **Conseil** : Commencez par des projets simples (affichage de capteurs, serveur web basique) avant de vous lancer dans des applications complexes. Le Raspberry Pi est une plateforme id√©ale pour apprendre et exp√©rimenter!

‚è≠Ô∏è [Cross-compilation depuis Windows](/13-developpement-mobile-embarque/07.1-cross-compilation-depuis-windows.md)
