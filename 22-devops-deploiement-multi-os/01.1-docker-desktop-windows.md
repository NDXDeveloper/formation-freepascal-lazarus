üîù Retour au [Sommaire](/SOMMAIRE.md)

# 22.1.1 Docker Desktop Windows

## Introduction √† Docker Desktop pour Windows

Docker Desktop est la solution officielle de Docker pour d√©velopper et ex√©cuter des applications conteneuris√©es sur Windows. Bien que vous soyez un d√©veloppeur avanc√© en FreePascal/Lazarus, si vous d√©butez avec Docker, ce guide vous accompagnera pas √† pas.

### Qu'est-ce que Docker ?

Docker est une plateforme qui permet d'empaqueter votre application FreePascal/Lazarus avec toutes ses d√©pendances dans un "conteneur". Imaginez un conteneur comme une bo√Æte autonome qui contient tout ce dont votre application a besoin pour fonctionner, ind√©pendamment de l'environnement Windows sur lequel elle s'ex√©cute.

**Avantages pour les d√©veloppeurs FreePascal/Lazarus :**
- D√©ploiement simplifi√© de vos applications
- Environnement de d√©veloppement reproductible
- Isolation des d√©pendances
- Facilite les tests multi-plateformes
- D√©ploiement cloud simplifi√©

## Pr√©requis syst√®me

Avant d'installer Docker Desktop sur Windows, v√©rifiez que votre syst√®me r√©pond aux exigences suivantes :

### Configuration minimale requise

**Syst√®me d'exploitation :**
- Windows 10 64-bit : Pro, Enterprise ou Education (Build 19044 ou sup√©rieur)
- Windows 11 64-bit : Pro, Enterprise ou Education

**Mat√©riel :**
- Processeur 64-bit avec support de la virtualisation (Intel VT-x ou AMD-V)
- Minimum 4 GB de RAM (8 GB recommand√©s)
- La virtualisation doit √™tre activ√©e dans le BIOS

### V√©rification de la virtualisation

Pour v√©rifier si la virtualisation est activ√©e sur votre syst√®me :

1. Ouvrez le **Gestionnaire des t√¢ches** (Ctrl + Shift + √âchap)
2. Allez dans l'onglet **Performance**
3. S√©lectionnez **CPU**
4. V√©rifiez la ligne **Virtualisation** : elle doit indiquer "Activ√©e"

Si elle indique "D√©sactiv√©e", vous devrez l'activer dans le BIOS de votre ordinateur (la proc√©dure varie selon le fabricant).

## Installation de Docker Desktop

### √âtape 1 : T√©l√©chargement

1. Rendez-vous sur le site officiel : [https://www.docker.com/products/docker-desktop](https://www.docker.com/products/docker-desktop)
2. Cliquez sur **Download for Windows**
3. Le fichier `Docker Desktop Installer.exe` sera t√©l√©charg√©

### √âtape 2 : Installation

1. **Ex√©cutez l'installateur** en double-cliquant sur `Docker Desktop Installer.exe`
2. **Acceptez les permissions** UAC si demand√©
3. **Configuration de l'installation** :
   - Cochez **"Use WSL 2 instead of Hyper-V"** (recommand√© pour de meilleures performances)
   - Cochez **"Add shortcut to desktop"** pour un acc√®s facile
4. Cliquez sur **Ok** pour lancer l'installation
5. L'installation prendra quelques minutes
6. Une fois termin√©e, cliquez sur **Close and restart** pour red√©marrer votre ordinateur

### √âtape 3 : Premier d√©marrage

1. Apr√®s le red√©marrage, lancez **Docker Desktop** depuis le menu D√©marrer ou le raccourci bureau
2. **Acceptez l'accord de service** Docker
3. **Connexion (optionnel)** : Vous pouvez cr√©er un compte Docker Hub ou continuer sans connexion
4. Docker Desktop d√©marre et affiche son tableau de bord

**V√©rification de l'installation :**

Ouvrez un terminal PowerShell ou une invite de commandes et tapez :

```powershell
docker --version
```

Vous devriez voir quelque chose comme :
```
Docker version 24.0.6, build ed223bc
```

Et ensuite :

```powershell
docker run hello-world
```

Cette commande t√©l√©charge une image de test et ex√©cute un conteneur. Si vous voyez un message de bienvenue, Docker fonctionne correctement !

## Configuration de base pour FreePascal/Lazarus

### Comprendre les composants Docker

Avant de cr√©er votre premier conteneur FreePascal, familiarisons-nous avec les concepts cl√©s :

**Image Docker :**
Une image est un mod√®le en lecture seule contenant votre application et ses d√©pendances. C'est comme une "photo" d'un syst√®me configur√©.

**Conteneur Docker :**
Un conteneur est une instance en cours d'ex√©cution d'une image. C'est l'environnement isol√© o√π votre application FreePascal s'ex√©cute.

**Dockerfile :**
Un fichier texte contenant les instructions pour construire une image Docker.

**Docker Hub :**
Un registre public d'images Docker (similaire √† GitHub pour le code).

### Configuration des ressources

Docker Desktop utilise des ressources syst√®me. Pour optimiser les performances avec vos projets FreePascal :

1. **Ouvrez Docker Desktop**
2. Cliquez sur l'ic√¥ne **Param√®tres** (roue dent√©e) en haut √† droite
3. Allez dans **Resources** ‚Üí **Advanced**

**Param√®tres recommand√©s pour d√©veloppement FreePascal/Lazarus :**
- **CPUs** : 2-4 c≈ìurs (selon votre machine)
- **Memory** : 4-8 GB
- **Swap** : 1-2 GB
- **Disk image size** : 60 GB minimum

4. Cliquez sur **Apply & restart**

### Configuration WSL 2 (recommand√©)

WSL 2 (Windows Subsystem for Linux 2) offre de meilleures performances pour Docker sur Windows.

**V√©rification de WSL 2 :**

Dans PowerShell (en administrateur) :

```powershell
wsl --list --verbose
```

Vous devriez voir des distributions avec VERSION 2.

**Si WSL 2 n'est pas install√© :**

```powershell
wsl --install
```

Puis red√©marrez votre ordinateur.

**Int√©gration avec Docker Desktop :**

1. Dans Docker Desktop, allez dans **Settings** ‚Üí **Resources** ‚Üí **WSL Integration**
2. Activez **"Enable integration with my default WSL distro"**
3. S√©lectionnez les distributions WSL avec lesquelles vous souhaitez utiliser Docker
4. Cliquez sur **Apply & restart**

## Premi√®re utilisation : Conteneuriser une application FreePascal simple

### Cr√©er un projet FreePascal de d√©monstration

Cr√©ons un programme simple en FreePascal que nous allons conteneuriser.

**Fichier : `hello.pas`**

```pascal
program HelloDocker;

{$mode objfpc}{$H+}

uses
  SysUtils;

begin
  WriteLn('Bonjour depuis un conteneur Docker !');
  WriteLn('Application FreePascal version 1.0');
  WriteLn('Syst√®me : ', {$I %FPCTARGETOS%});
  WriteLn('Architecture : ', {$I %FPCTARGETCPU%});
end.
```

### Cr√©er un Dockerfile pour FreePascal

Un Dockerfile est un fichier texte sans extension contenant les instructions de construction de votre image.

**Fichier : `Dockerfile`**

```dockerfile
# Utiliser une image de base avec FreePascal install√©
FROM alpine:latest

# Installer FreePascal et les d√©pendances
RUN apk add --no-cache fpc

# Cr√©er un r√©pertoire de travail
WORKDIR /app

# Copier le code source dans le conteneur
COPY hello.pas .

# Compiler l'application
RUN fpc -O2 hello.pas

# Commande √† ex√©cuter au d√©marrage du conteneur
CMD ["./hello"]
```

**Explication ligne par ligne :**

- `FROM alpine:latest` : Utilise Alpine Linux (distribution l√©g√®re) comme base
- `RUN apk add --no-cache fpc` : Installe le compilateur FreePascal
- `WORKDIR /app` : D√©finit le r√©pertoire de travail dans le conteneur
- `COPY hello.pas .` : Copie votre fichier source dans le conteneur
- `RUN fpc -O2 hello.pas` : Compile votre programme avec optimisation
- `CMD ["./hello"]` : D√©finit la commande ex√©cut√©e au lancement du conteneur

### Construire l'image Docker

Dans le r√©pertoire contenant `hello.pas` et `Dockerfile`, ouvrez PowerShell ou une invite de commandes :

```powershell
docker build -t freepascal-hello:1.0 .
```

**Explication de la commande :**
- `docker build` : Commande de construction d'image
- `-t freepascal-hello:1.0` : Nom et version de l'image (tag)
- `.` : Le contexte de construction (r√©pertoire actuel)

Docker va :
1. T√©l√©charger l'image de base Alpine
2. Installer FreePascal
3. Copier votre code
4. Compiler votre programme
5. Cr√©er l'image finale

### Ex√©cuter le conteneur

Une fois l'image construite :

```powershell
docker run freepascal-hello:1.0
```

Vous devriez voir :
```
Bonjour depuis un conteneur Docker !
Application FreePascal version 1.0
Syst√®me : linux
Architecture : x86_64
```

**F√©licitations !** Vous venez d'ex√©cuter votre premi√®re application FreePascal dans un conteneur Docker sur Windows !

## Commandes Docker essentielles

### Gestion des images

**Lister les images locales :**
```powershell
docker images
```

**Supprimer une image :**
```powershell
docker rmi freepascal-hello:1.0
```

**T√©l√©charger une image depuis Docker Hub :**
```powershell
docker pull ubuntu:22.04
```

### Gestion des conteneurs

**Lister les conteneurs en cours d'ex√©cution :**
```powershell
docker ps
```

**Lister tous les conteneurs (y compris arr√™t√©s) :**
```powershell
docker ps -a
```

**Arr√™ter un conteneur :**
```powershell
docker stop <container_id>
```

**Supprimer un conteneur :**
```powershell
docker rm <container_id>
```

**Ex√©cuter un conteneur en mode interactif :**
```powershell
docker run -it ubuntu:22.04 /bin/bash
```

L'option `-it` permet d'avoir un terminal interactif dans le conteneur.

### Nettoyage

**Supprimer tous les conteneurs arr√™t√©s :**
```powershell
docker container prune
```

**Supprimer toutes les images non utilis√©es :**
```powershell
docker image prune -a
```

**Nettoyage complet du syst√®me Docker :**
```powershell
docker system prune -a --volumes
```

‚ö†Ô∏è **Attention :** Cette commande supprime tout (conteneurs, images, volumes) sauf ce qui est en cours d'utilisation.

## Volumes Docker : Persistance des donn√©es

Par d√©faut, les donn√©es dans un conteneur sont perdues lorsqu'il est supprim√©. Les volumes permettent de persister les donn√©es.

### Cr√©er et utiliser un volume

**Cr√©er un volume :**
```powershell
docker volume create freepascal-data
```

**Utiliser un volume avec un conteneur :**
```powershell
docker run -v freepascal-data:/app/data freepascal-hello:1.0
```

Le dossier `/app/data` dans le conteneur sera persist√© dans le volume `freepascal-data`.

### Monter un dossier Windows dans un conteneur

Tr√®s utile pour le d√©veloppement :

```powershell
docker run -v C:\MonProjet:/app freepascal-hello:1.0
```

Votre dossier Windows `C:\MonProjet` sera accessible dans `/app` dans le conteneur.

**Note WSL 2 :** Pour de meilleures performances, utilisez des chemins WSL :
```powershell
docker run -v /mnt/c/MonProjet:/app freepascal-hello:1.0
```

## R√©seaux Docker

Les conteneurs peuvent communiquer entre eux via des r√©seaux Docker.

### Cr√©er un r√©seau

```powershell
docker network create freepascal-network
```

### Connecter des conteneurs au r√©seau

```powershell
docker run --network freepascal-network --name app1 freepascal-hello:1.0
docker run --network freepascal-network --name app2 freepascal-hello:1.0
```

Les conteneurs `app1` et `app2` peuvent communiquer entre eux en utilisant leurs noms.

## Docker Compose : Orchestration simplifi√©e

Docker Compose permet de d√©finir et g√©rer plusieurs conteneurs avec un seul fichier de configuration.

### Installation

Docker Compose est inclus avec Docker Desktop pour Windows, aucune installation suppl√©mentaire n'est n√©cessaire.

**V√©rification :**
```powershell
docker-compose --version
```

### Exemple de fichier docker-compose.yml

**Fichier : `docker-compose.yml`**

```yaml
version: '3.8'

services:
  app:
    build: .
    container_name: freepascal-app
    volumes:
      - ./src:/app/src
    networks:
      - app-network

  database:
    image: postgres:15
    container_name: freepascal-db
    environment:
      POSTGRES_PASSWORD: motdepasse
      POSTGRES_DB: mabase
    volumes:
      - db-data:/var/lib/postgresql/data
    networks:
      - app-network

volumes:
  db-data:

networks:
  app-network:
```

### Utilisation de Docker Compose

**D√©marrer tous les services :**
```powershell
docker-compose up
```

**D√©marrer en arri√®re-plan :**
```powershell
docker-compose up -d
```

**Arr√™ter tous les services :**
```powershell
docker-compose down
```

**Voir les logs :**
```powershell
docker-compose logs -f
```

## Cas d'usage avanc√©s pour FreePascal/Lazarus

### Conteneuriser une application LCL (GUI)

Pour ex√©cuter une application graphique Lazarus depuis Docker sur Windows :

**Dockerfile :**
```dockerfile
FROM ubuntu:22.04

# Installer les d√©pendances
RUN apt-get update && apt-get install -y \
    fpc \
    lazarus \
    xvfb \
    x11vnc \
    && rm -rf /var/lib/apt/lists/*

WORKDIR /app
COPY . .

# Compiler l'application
RUN lazbuild --build-mode=Release monprojet.lpi

# Exposer le port VNC
EXPOSE 5900

CMD ["x11vnc", "-create", "-forever"]
```

Vous pourrez ensuite vous connecter avec un client VNC pour voir l'interface graphique.

### Application FreePascal avec base de donn√©es

**docker-compose.yml :**
```yaml
version: '3.8'

services:
  app:
    build: .
    depends_on:
      - postgres
    environment:
      DB_HOST: postgres
      DB_PORT: 5432
      DB_NAME: myapp
      DB_USER: appuser
      DB_PASSWORD: apppass
    networks:
      - backend

  postgres:
    image: postgres:15
    environment:
      POSTGRES_DB: myapp
      POSTGRES_USER: appuser
      POSTGRES_PASSWORD: apppass
    volumes:
      - postgres-data:/var/lib/postgresql/data
    networks:
      - backend

volumes:
  postgres-data:

networks:
  backend:
```

### Cross-compilation dans Docker

Cr√©ez un environnement de cross-compilation pour g√©n√©rer des binaires Linux depuis Windows :

**Dockerfile :**
```dockerfile
FROM ubuntu:22.04

RUN apt-get update && apt-get install -y \
    fpc \
    fpc-source \
    && rm -rf /var/lib/apt/lists/*

WORKDIR /build

# Script de compilation
COPY compile.sh .
RUN chmod +x compile.sh

VOLUME /source
VOLUME /output

CMD ["./compile.sh"]
```

**compile.sh :**
```bash
#!/bin/bash
fpc -O3 -XX -CX /source/monapp.pas -o/output/monapp-linux
```

**Utilisation :**
```powershell
docker run -v C:\MonProjet:/source -v C:\MonProjet\bin:/output fpc-crosscompile
```

## D√©bogage et bonnes pratiques

### Visualiser les logs d'un conteneur

```powershell
docker logs <container_id>
```

**En temps r√©el :**
```powershell
docker logs -f <container_id>
```

### Ex√©cuter une commande dans un conteneur en cours d'ex√©cution

```powershell
docker exec -it <container_id> /bin/bash
```

Cela ouvre un shell interactif dans le conteneur pour investiguer.

### Inspecter un conteneur

```powershell
docker inspect <container_id>
```

Affiche toutes les informations d√©taill√©es du conteneur (configuration, r√©seau, volumes, etc.).

### Bonnes pratiques

**Optimisation des images :**
- Utilisez des images de base l√©g√®res (Alpine, slim)
- Combinez les commandes RUN pour r√©duire les layers
- Nettoyez les caches apr√®s installation de packages
- Utilisez `.dockerignore` pour exclure les fichiers inutiles

**Exemple de .dockerignore :**
```
*.o
*.ppu
*.compiled
lib/
backup/
*.bak
.git/
```

**S√©curit√© :**
- Ne stockez jamais de mots de passe dans les Dockerfiles
- Utilisez des secrets Docker ou variables d'environnement
- Scannez vos images pour les vuln√©rabilit√©s
- N'ex√©cutez pas les conteneurs en tant que root si possible

**Versioning :**
- Utilisez des tags explicites pour vos images
- √âvitez le tag `latest` en production
- Documentez les changements entre versions

## Int√©gration avec Docker Hub

### Cr√©er un compte Docker Hub

1. Rendez-vous sur [https://hub.docker.com](https://hub.docker.com)
2. Cr√©ez un compte gratuit
3. Confirmez votre adresse email

### Se connecter depuis Docker Desktop

```powershell
docker login
```

Entrez votre nom d'utilisateur et mot de passe Docker Hub.

### Pousser une image sur Docker Hub

**Tagguer votre image :**
```powershell
docker tag freepascal-hello:1.0 votre-username/freepascal-hello:1.0
```

**Pousser l'image :**
```powershell
docker push votre-username/freepascal-hello:1.0
```

Votre image est maintenant publique et peut √™tre t√©l√©charg√©e par n'importe qui avec :
```powershell
docker pull votre-username/freepascal-hello:1.0
```

## R√©solution des probl√®mes courants

### Docker Desktop ne d√©marre pas

**Solutions possibles :**
1. V√©rifiez que la virtualisation est activ√©e dans le BIOS
2. Assurez-vous que WSL 2 est correctement install√©
3. Red√©marrez le service Docker depuis les Services Windows
4. R√©installez Docker Desktop en mode administrateur

### "Error response from daemon: conflict"

Ce message appara√Æt si un conteneur avec le m√™me nom existe d√©j√†.

**Solution :**
```powershell
docker rm -f <container_name>
```

### Probl√®mes de performance

**Solutions :**
- Allouez plus de ressources √† Docker Desktop (Settings ‚Üí Resources)
- Utilisez WSL 2 plut√¥t que Hyper-V
- Placez vos projets dans le syst√®me de fichiers WSL pour de meilleures performances

### "Cannot connect to the Docker daemon"

Le service Docker n'est pas d√©marr√©.

**Solution :**
- Lancez Docker Desktop
- Ou depuis PowerShell (admin) : `Start-Service docker`

## Ressources suppl√©mentaires

### Documentation officielle

- **Docker Desktop pour Windows :** [https://docs.docker.com/desktop/install/windows-install/](https://docs.docker.com/desktop/install/windows-install/)
- **Docker CLI Reference :** [https://docs.docker.com/engine/reference/commandline/cli/](https://docs.docker.com/engine/reference/commandline/cli/)
- **Dockerfile Reference :** [https://docs.docker.com/engine/reference/builder/](https://docs.docker.com/engine/reference/builder/)
- **Docker Compose :** [https://docs.docker.com/compose/](https://docs.docker.com/compose/)

### Images Docker utiles pour FreePascal

- `alpine:latest` - Distribution l√©g√®re avec support FPC via apk
- `ubuntu:22.04` - Ubuntu avec possibilit√© d'installer Lazarus complet
- `debian:bullseye` - Alternative stable pour environnements FPC/Lazarus

### Communaut√©

- **Docker Forums :** [https://forums.docker.com](https://forums.docker.com)
- **FreePascal Forum (section Docker) :** [https://forum.lazarus.freepascal.org](https://forum.lazarus.freepascal.org)
- **Stack Overflow :** Tags `docker` et `freepascal`

## Conclusion

Docker Desktop pour Windows est un outil puissant qui transforme la mani√®re dont vous d√©veloppez, testez et d√©ployez vos applications FreePascal/Lazarus. En ma√Ætrisant les concepts de base pr√©sent√©s dans ce tutoriel, vous √™tes maintenant capable de :

‚úÖ Installer et configurer Docker Desktop sur Windows
‚úÖ Cr√©er des images Docker pour vos applications FreePascal
‚úÖ G√©rer des conteneurs et orchestrer des services avec Docker Compose
‚úÖ Utiliser Docker pour le d√©veloppement cross-platform
‚úÖ D√©ployer vos applications de mani√®re portable et reproductible

L'apprentissage de Docker est un processus continu. N'h√©sitez pas √† exp√©rimenter, √† consulter la documentation officielle et √† participer aux communaut√©s pour approfondir vos connaissances.

Dans la prochaine section (22.1.2), nous explorerons Docker natif sur Ubuntu et comparerons les diff√©rences avec l'impl√©mentation Windows.

**Bonne conteneurisation ! üê≥**

‚è≠Ô∏è [Docker natif Ubuntu](/22-devops-deploiement-multi-os/01.2-docker-natif-ubuntu.md)
