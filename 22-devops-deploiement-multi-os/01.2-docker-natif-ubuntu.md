üîù Retour au [Sommaire](/SOMMAIRE.md)

# 22.1.2 Docker natif Ubuntu

## Introduction √† Docker natif sur Ubuntu

Docker sur Ubuntu offre une exp√©rience native et performante pour conteneuriser vos applications FreePascal/Lazarus. Contrairement √† Windows qui n√©cessite une couche de virtualisation (WSL 2 ou Hyper-V), Docker s'ex√©cute directement sur le noyau Linux d'Ubuntu, ce qui garantit des performances optimales.

### Pourquoi Docker natif sur Ubuntu ?

**Avantages principaux :**
- **Performances maximales** : Pas de couche de virtualisation interm√©diaire
- **Int√©gration syst√®me native** : Docker utilise directement les fonctionnalit√©s du noyau Linux
- **L√©g√®ret√©** : Consommation minimale de ressources
- **Stabilit√©** : Environnement de production privil√©gi√©
- **√âcosyst√®me** : La majorit√© des images Docker sont con√ßues pour Linux

Pour un d√©veloppeur FreePascal/Lazarus, Docker sur Ubuntu est l'outil id√©al pour :
- Cr√©er des environnements de compilation reproductibles
- Tester vos applications dans diff√©rentes versions d'Ubuntu
- D√©ployer facilement sur des serveurs Linux
- D√©velopper des microservices

## Pr√©requis syst√®me

### Configuration minimale requise

**Syst√®me d'exploitation :**
- Ubuntu 20.04 LTS (Focal Fossa) ou sup√©rieur
- Ubuntu 22.04 LTS (Jammy Jellyfish) recommand√©
- Ubuntu 24.04 LTS (Noble Numbat)
- Ou d√©riv√©s : Linux Mint, Pop!_OS, Elementary OS, etc.

**Architecture :**
- x86_64 / amd64
- ARM64 / aarch64 (pour Raspberry Pi et serveurs ARM)

**Mat√©riel :**
- Minimum 2 GB de RAM (4 GB recommand√©s)
- 20 GB d'espace disque libre
- Processeur 64-bit

### V√©rification de votre syst√®me

Ouvrez un terminal (Ctrl + Alt + T) et v√©rifiez votre version d'Ubuntu :

```bash
lsb_release -a
```

V√©rifiez l'architecture :

```bash
uname -m
```

Vous devriez voir `x86_64` ou `aarch64`.

## M√©thodes d'installation

Il existe plusieurs m√©thodes pour installer Docker sur Ubuntu. Nous allons couvrir les trois principales.

### M√©thode 1 : Installation via le d√©p√¥t officiel Docker (Recommand√©e)

Cette m√©thode garantit que vous obtenez la derni√®re version stable de Docker directement depuis les serveurs officiels.

#### √âtape 1 : Pr√©paration du syst√®me

**Mise √† jour des paquets :**

```bash
sudo apt update
sudo apt upgrade -y
```

**Installation des pr√©requis :**

```bash
sudo apt install -y \
    ca-certificates \
    curl \
    gnupg \
    lsb-release
```

**Explication des paquets :**
- `ca-certificates` : Certificats pour connexions HTTPS s√©curis√©es
- `curl` : Outil de t√©l√©chargement depuis la ligne de commande
- `gnupg` : Gestion des cl√©s de signature GPG
- `lsb-release` : Informations sur la distribution Linux

#### √âtape 2 : Ajout du d√©p√¥t Docker officiel

**Cr√©er le r√©pertoire pour les cl√©s GPG :**

```bash
sudo install -m 0755 -d /etc/apt/keyrings
```

**T√©l√©charger et ajouter la cl√© GPG officielle Docker :**

```bash
curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo gpg --dearmor -o /etc/apt/keyrings/docker.gpg
```

**D√©finir les permissions de la cl√© :**

```bash
sudo chmod a+r /etc/apt/keyrings/docker.gpg
```

**Ajouter le d√©p√¥t Docker aux sources APT :**

```bash
echo \
  "deb [arch=$(dpkg --print-architecture) signed-by=/etc/apt/keyrings/docker.gpg] https://download.docker.com/linux/ubuntu \
  $(. /etc/os-release && echo "$VERSION_CODENAME") stable" | \
  sudo tee /etc/apt/sources.list.d/docker.list > /dev/null
```

**Mettre √† jour la liste des paquets :**

```bash
sudo apt update
```

#### √âtape 3 : Installation de Docker Engine

**Installer Docker et ses composants :**

```bash
sudo apt install -y docker-ce docker-ce-cli containerd.io docker-buildx-plugin docker-compose-plugin
```

**Explication des composants :**
- `docker-ce` : Docker Community Edition (moteur principal)
- `docker-ce-cli` : Interface en ligne de commande Docker
- `containerd.io` : Runtime de conteneurs
- `docker-buildx-plugin` : Constructeur avanc√© d'images
- `docker-compose-plugin` : Outil d'orchestration de conteneurs

#### √âtape 4 : V√©rification de l'installation

**V√©rifier que Docker est install√© et actif :**

```bash
sudo docker --version
```

Vous devriez voir quelque chose comme :
```
Docker version 24.0.7, build afdd53b
```

**V√©rifier le statut du service Docker :**

```bash
sudo systemctl status docker
```

Le service doit √™tre `active (running)`.

**Test avec un conteneur Hello World :**

```bash
sudo docker run hello-world
```

Si tout fonctionne, vous verrez un message de bienvenue de Docker !

### M√©thode 2 : Installation via Snap (Alternative simple)

Snap est un syst√®me de paquets universel pr√©install√© sur Ubuntu.

**Installation en une commande :**

```bash
sudo snap install docker
```

**Avantages :**
- Installation tr√®s simple
- Mises √† jour automatiques
- Isolation renforc√©e

**Inconv√©nients :**
- L√©g√®rement plus lent que l'installation native
- Certaines fonctionnalit√©s avanc√©es peuvent √™tre limit√©es

### M√©thode 3 : Script d'installation automatique

Docker propose un script d'installation simplifi√© pour les tests et environnements de d√©veloppement.

‚ö†Ô∏è **Attention :** Cette m√©thode n'est **pas recommand√©e pour la production**.

```bash
curl -fsSL https://get.docker.com -o get-docker.sh
sudo sh get-docker.sh
```

Le script d√©tecte automatiquement votre distribution et installe Docker.

## Configuration post-installation

### Ex√©cuter Docker sans sudo (Recommand√©)

Par d√©faut, Docker n√©cessite les privil√®ges root. Pour √©viter d'utiliser `sudo` √† chaque commande :

**Ajouter votre utilisateur au groupe docker :**

```bash
sudo usermod -aG docker $USER
```

**Appliquer les changements de groupe :**

Vous devez vous d√©connecter puis vous reconnecter, ou ex√©cuter :

```bash
newgrp docker
```

**V√©rification :**

```bash
docker run hello-world
```

Cette fois, **sans `sudo`** ! Si cela fonctionne, la configuration est correcte.

### Configurer Docker pour d√©marrer automatiquement

**Activer le d√©marrage automatique :**

```bash
sudo systemctl enable docker.service
sudo systemctl enable containerd.service
```

**V√©rifier l'√©tat :**

```bash
sudo systemctl is-enabled docker
```

Devrait afficher `enabled`.

### Configuration des ressources syst√®me

Docker sur Ubuntu utilise directement les ressources du syst√®me. Aucune configuration sp√©ciale n'est n√©cessaire comme sur Docker Desktop Windows.

**V√©rifier l'utilisation des ressources :**

```bash
docker system df
```

Affiche l'espace disque utilis√© par Docker.

**Limiter les ressources d'un conteneur (si n√©cessaire) :**

```bash
docker run -m 512m --cpus=1.5 mon-conteneur
```

- `-m 512m` : Limite la RAM √† 512 MB
- `--cpus=1.5` : Limite √† 1.5 c≈ìurs CPU

## Premi√®re utilisation : Application FreePascal sous Docker

### Cr√©er une application FreePascal simple

**Fichier : `hello_ubuntu.pas`**

```pascal
program HelloUbuntu;

{$mode objfpc}{$H+}

uses
  SysUtils, Unix;

var
  hostname: String;

begin
  WriteLn('=================================');
  WriteLn('FreePascal sur Docker Ubuntu');
  WriteLn('=================================');
  WriteLn;

  WriteLn('Syst√®me : ', {$I %FPCTARGETOS%});
  WriteLn('Architecture : ', {$I %FPCTARGETCPU%});
  WriteLn('Version FPC : ', {$I %FPCVERSION%});

  // Obtenir le nom d'h√¥te du conteneur
  hostname := GetHostName;
  WriteLn('Hostname : ', hostname);

  WriteLn;
  WriteLn('Application compil√©e et ex√©cut√©e avec succ√®s !');
end.
```

### Cr√©er un Dockerfile optimis√© pour Ubuntu

**Fichier : `Dockerfile`**

```dockerfile
# Image de base Ubuntu 22.04
FROM ubuntu:22.04

# √âviter les prompts interactifs lors de l'installation
ENV DEBIAN_FRONTEND=noninteractive

# Mettre √† jour et installer FreePascal
RUN apt-get update && \
    apt-get install -y \
    fpc \
    fp-compiler \
    fp-utils \
    && rm -rf /var/lib/apt/lists/*

# Informations de build
LABEL maintainer="votre.email@example.com"
LABEL description="Application FreePascal sur Ubuntu"
LABEL version="1.0"

# Cr√©er un utilisateur non-root pour l'ex√©cution
RUN useradd -m -s /bin/bash fpuser

# D√©finir le r√©pertoire de travail
WORKDIR /app

# Copier le code source
COPY hello_ubuntu.pas .

# Changer les permissions
RUN chown -R fpuser:fpuser /app

# Compiler en tant qu'utilisateur non-root
USER fpuser
RUN fpc -O3 -XX -CX hello_ubuntu.pas

# Commande par d√©faut
CMD ["./hello_ubuntu"]
```

**Explications des bonnes pratiques :**

- `ENV DEBIAN_FRONTEND=noninteractive` : √âvite les prompts pendant l'installation
- `rm -rf /var/lib/apt/lists/*` : Nettoie le cache APT pour r√©duire la taille de l'image
- `useradd` : Cr√©e un utilisateur non-root pour plus de s√©curit√©
- `LABEL` : M√©tadonn√©es pour identifier l'image
- `-O3 -XX -CX` : Options de compilation pour optimisation et ex√©cutable standalone

### Construire et ex√©cuter l'image

**Construction :**

```bash
docker build -t freepascal-ubuntu:1.0 .
```

Le point `.` indique que le contexte de construction est le r√©pertoire courant.

**Ex√©cution :**

```bash
docker run --rm freepascal-ubuntu:1.0
```

L'option `--rm` supprime automatiquement le conteneur apr√®s son arr√™t.

**Sortie attendue :**
```
=================================
FreePascal sur Docker Ubuntu
=================================

Syst√®me : linux
Architecture : x86_64
Version FPC : 3.2.2
Hostname : a1b2c3d4e5f6

Application compil√©e et ex√©cut√©e avec succ√®s !
```

## Utilisation avanc√©e pour FreePascal/Lazarus

### Dockerfile multi-stage pour r√©duire la taille

Un build multi-stage s√©pare la compilation de l'ex√©cution, cr√©ant des images finales beaucoup plus l√©g√®res.

**Fichier : `Dockerfile.multistage`**

```dockerfile
# ===== STAGE 1: Compilation =====
FROM ubuntu:22.04 AS builder

ENV DEBIAN_FRONTEND=noninteractive

RUN apt-get update && \
    apt-get install -y fpc && \
    rm -rf /var/lib/apt/lists/*

WORKDIR /build
COPY . .

# Compilation statique
RUN fpc -O3 -XX -CX -Xs hello_ubuntu.pas

# ===== STAGE 2: Ex√©cution =====
FROM ubuntu:22.04

# Installation minimale (biblioth√®ques de base uniquement)
RUN apt-get update && \
    apt-get install -y --no-install-recommends \
    libc6 \
    && rm -rf /var/lib/apt/lists/*

# Utilisateur non-root
RUN useradd -m -s /bin/bash fpuser

WORKDIR /app

# Copier uniquement l'ex√©cutable depuis le stage de build
COPY --from=builder /build/hello_ubuntu .
RUN chown fpuser:fpuser hello_ubuntu

USER fpuser

CMD ["./hello_ubuntu"]
```

**Avantages :**
- Image finale beaucoup plus petite (pas le compilateur FPC)
- S√©curit√© renforc√©e (moins de packages)
- Temps de d√©marrage r√©duit

**Construction :**

```bash
docker build -f Dockerfile.multistage -t freepascal-ubuntu:slim .
```

**Comparaison des tailles :**

```bash
docker images | grep freepascal-ubuntu
```

Vous verrez que l'image `slim` est significativement plus petite.

### Application Lazarus LCL (Interface graphique)

Pour une application avec interface graphique, nous avons besoin de X11.

**Fichier : `Dockerfile.gui`**

```dockerfile
FROM ubuntu:22.04

ENV DEBIAN_FRONTEND=noninteractive

# Installer Lazarus et d√©pendances X11
RUN apt-get update && \
    apt-get install -y \
    lazarus \
    lcl \
    lcl-gtk2 \
    libgtk2.0-0 \
    x11-apps \
    && rm -rf /var/lib/apt/lists/*

WORKDIR /app
COPY . .

# Compiler le projet Lazarus
RUN lazbuild --build-mode=Release monprojet.lpi

CMD ["./monprojet"]
```

**Ex√©cution avec affichage X11 :**

```bash
# Autoriser les connexions X11 locales
xhost +local:docker

# Lancer le conteneur avec acc√®s √† l'affichage
docker run --rm \
    -e DISPLAY=$DISPLAY \
    -v /tmp/.X11-unix:/tmp/.X11-unix \
    freepascal-gui:1.0

# R√©voquer l'acc√®s apr√®s utilisation
xhost -local:docker
```

**Explication :**
- `-e DISPLAY=$DISPLAY` : Passe la variable d'environnement d'affichage
- `-v /tmp/.X11-unix:/tmp/.X11-unix` : Monte le socket X11
- `xhost +local:docker` : Autorise Docker √† se connecter au serveur X

### Application avec base de donn√©es PostgreSQL

**Fichier : `docker-compose.yml`**

```yaml
version: '3.8'

services:
  app:
    build: .
    container_name: freepascal-app
    depends_on:
      - db
    environment:
      DB_HOST: db
      DB_PORT: 5432
      DB_NAME: freepascal_db
      DB_USER: fpuser
      DB_PASSWORD: secretpassword
    networks:
      - app-network
    volumes:
      - ./src:/app/src
    command: ./monapp

  db:
    image: postgres:15-alpine
    container_name: freepascal-db
    environment:
      POSTGRES_DB: freepascal_db
      POSTGRES_USER: fpuser
      POSTGRES_PASSWORD: secretpassword
    volumes:
      - postgres-data:/var/lib/postgresql/data
      - ./sql/init.sql:/docker-entrypoint-initdb.d/init.sql
    networks:
      - app-network
    ports:
      - "5432:5432"

volumes:
  postgres-data:

networks:
  app-network:
    driver: bridge
```

**Code FreePascal de connexion (exemple avec SQLdb) :**

```pascal
program DBExample;

{$mode objfpc}{$H+}

uses
  SysUtils, sqldb, pqconnection;

var
  Conn: TPQConnection;
  Trans: TSQLTransaction;
  Query: TSQLQuery;

begin
  Conn := TPQConnection.Create(nil);
  Trans := TSQLTransaction.Create(nil);
  Query := TSQLQuery.Create(nil);

  try
    // Configuration depuis variables d'environnement
    Conn.HostName := GetEnvironmentVariable('DB_HOST');
    Conn.DatabaseName := GetEnvironmentVariable('DB_NAME');
    Conn.UserName := GetEnvironmentVariable('DB_USER');
    Conn.Password := GetEnvironmentVariable('DB_PASSWORD');

    Conn.Transaction := Trans;
    Query.Database := Conn;

    Conn.Open;
    WriteLn('Connexion √† PostgreSQL r√©ussie !');

    Query.SQL.Text := 'SELECT version()';
    Query.Open;
    WriteLn('Version PostgreSQL : ', Query.Fields[0].AsString);

  finally
    Query.Free;
    Trans.Free;
    Conn.Free;
  end;
end.
```

**D√©marrage de l'environnement complet :**

```bash
docker-compose up -d
```

**Voir les logs :**

```bash
docker-compose logs -f app
```

## Commandes Docker essentielles sur Ubuntu

### Gestion du service Docker

**D√©marrer Docker :**
```bash
sudo systemctl start docker
```

**Arr√™ter Docker :**
```bash
sudo systemctl stop docker
```

**Red√©marrer Docker :**
```bash
sudo systemctl restart docker
```

**Statut du service :**
```bash
sudo systemctl status docker
```

**Logs du daemon Docker :**
```bash
sudo journalctl -u docker.service
```

### Gestion des images

**Lister les images :**
```bash
docker images
```

**Rechercher une image sur Docker Hub :**
```bash
docker search ubuntu
```

**T√©l√©charger une image :**
```bash
docker pull ubuntu:22.04
```

**Supprimer une image :**
```bash
docker rmi ubuntu:22.04
```

**Inspecter une image :**
```bash
docker inspect ubuntu:22.04
```

**Afficher l'historique d'une image :**
```bash
docker history ubuntu:22.04
```

### Gestion des conteneurs

**Lister les conteneurs actifs :**
```bash
docker ps
```

**Lister tous les conteneurs :**
```bash
docker ps -a
```

**D√©marrer un conteneur :**
```bash
docker start <container_id>
```

**Arr√™ter un conteneur :**
```bash
docker stop <container_id>
```

**Red√©marrer un conteneur :**
```bash
docker restart <container_id>
```

**Supprimer un conteneur :**
```bash
docker rm <container_id>
```

**Supprimer un conteneur en cours d'ex√©cution :**
```bash
docker rm -f <container_id>
```

**Ex√©cuter une commande dans un conteneur actif :**
```bash
docker exec -it <container_id> /bin/bash
```

**Voir les logs d'un conteneur :**
```bash
docker logs <container_id>
```

**Suivre les logs en temps r√©el :**
```bash
docker logs -f <container_id>
```

### Nettoyage du syst√®me

**Supprimer tous les conteneurs arr√™t√©s :**
```bash
docker container prune
```

**Supprimer toutes les images non utilis√©es :**
```bash
docker image prune -a
```

**Supprimer tous les volumes non utilis√©s :**
```bash
docker volume prune
```

**Nettoyage complet :**
```bash
docker system prune -a --volumes
```

‚ö†Ô∏è Cette commande supprime TOUT ce qui n'est pas utilis√© actuellement.

**Voir l'espace disque utilis√© par Docker :**
```bash
docker system df
```

**Voir l'espace d√©taill√© :**
```bash
docker system df -v
```

## Volumes et stockage persistant

### Types de volumes sous Ubuntu

**1. Volumes Docker (Recommand√©)**

G√©r√©s par Docker, stock√©s dans `/var/lib/docker/volumes/`.

**Cr√©er un volume :**
```bash
docker volume create freepascal-data
```

**Lister les volumes :**
```bash
docker volume ls
```

**Inspecter un volume :**
```bash
docker volume inspect freepascal-data
```

**Utiliser un volume :**
```bash
docker run -v freepascal-data:/app/data freepascal-ubuntu:1.0
```

**Supprimer un volume :**
```bash
docker volume rm freepascal-data
```

**2. Bind Mounts**

Monte un r√©pertoire de votre syst√®me de fichiers Ubuntu directement.

```bash
docker run -v /home/user/monprojet:/app freepascal-ubuntu:1.0
```

**Avantages :**
- Acc√®s direct aux fichiers depuis Ubuntu
- Modifications instantan√©es
- Id√©al pour le d√©veloppement

**3. Tmpfs Mounts**

Stockage temporaire en RAM (non persistant).

```bash
docker run --tmpfs /app/temp:rw,size=1g freepascal-ubuntu:1.0
```

### Exemple de d√©veloppement avec bind mount

**Structure du projet :**
```
~/monprojet/
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îî‚îÄ‚îÄ main.pas
‚îú‚îÄ‚îÄ Dockerfile
‚îî‚îÄ‚îÄ compile.sh
```

**Compilation dans un conteneur avec bind mount :**

```bash
docker run --rm \
    -v ~/monprojet:/workspace \
    -w /workspace \
    ubuntu:22.04 \
    bash -c "apt-get update && apt-get install -y fpc && fpc src/main.pas"
```

Le binaire compil√© appara√Æt directement dans votre r√©pertoire Ubuntu !

## R√©seaux Docker sur Ubuntu

### Types de r√©seaux

**1. Bridge (par d√©faut)**

Les conteneurs peuvent communiquer entre eux sur le m√™me r√©seau bridge.

**Cr√©er un r√©seau bridge :**
```bash
docker network create freepascal-net
```

**Lancer des conteneurs sur ce r√©seau :**
```bash
docker run -d --name app1 --network freepascal-net freepascal-ubuntu:1.0
docker run -d --name app2 --network freepascal-net freepascal-ubuntu:1.0
```

Les conteneurs `app1` et `app2` peuvent se contacter par leurs noms.

**2. Host**

Le conteneur partage directement le r√©seau de l'h√¥te Ubuntu.

```bash
docker run --network host freepascal-ubuntu:1.0
```

**Cas d'usage :**
- Performance r√©seau maximale
- Acc√®s direct aux services de l'h√¥te

**3. None**

Aucune connectivit√© r√©seau.

```bash
docker run --network none freepascal-ubuntu:1.0
```

### Exposition de ports

**Publier un port :**
```bash
docker run -p 8080:80 freepascal-web:1.0
```

Le port 80 du conteneur est accessible sur le port 8080 d'Ubuntu.

**Publier sur une IP sp√©cifique :**
```bash
docker run -p 127.0.0.1:8080:80 freepascal-web:1.0
```

**Publier tous les ports expos√©s :**
```bash
docker run -P freepascal-web:1.0
```

### Inspection r√©seau

**Lister les r√©seaux :**
```bash
docker network ls
```

**Inspecter un r√©seau :**
```bash
docker network inspect bridge
```

**Voir les conteneurs connect√©s √† un r√©seau :**
```bash
docker network inspect freepascal-net | grep -A 10 "Containers"
```

## Docker Compose sur Ubuntu

Docker Compose est essentiel pour g√©rer des applications multi-conteneurs.

### Installation de Docker Compose

Si vous avez install√© Docker via le d√©p√¥t officiel, Docker Compose est d√©j√† install√© comme plugin.

**V√©rification :**
```bash
docker compose version
```

**Si non install√©, installation manuelle :**

```bash
sudo apt-get update
sudo apt-get install docker-compose-plugin
```

**Ou version standalone (ancienne m√©thode) :**

```bash
sudo curl -L "https://github.com/docker/compose/releases/latest/download/docker-compose-$(uname -s)-$(uname -m)" -o /usr/local/bin/docker-compose
sudo chmod +x /usr/local/bin/docker-compose
```

### Exemple complet : Application FreePascal full-stack

**Structure du projet :**
```
~/freepascal-fullstack/
‚îú‚îÄ‚îÄ docker-compose.yml
‚îú‚îÄ‚îÄ app/
‚îÇ   ‚îú‚îÄ‚îÄ Dockerfile
‚îÇ   ‚îî‚îÄ‚îÄ src/
‚îÇ       ‚îî‚îÄ‚îÄ server.pas
‚îú‚îÄ‚îÄ web/
‚îÇ   ‚îî‚îÄ‚îÄ index.html
‚îî‚îÄ‚îÄ database/
    ‚îî‚îÄ‚îÄ init.sql
```

**Fichier : `docker-compose.yml`**

```yaml
version: '3.8'

services:
  # Application FreePascal (API backend)
  backend:
    build: ./app
    container_name: fp-backend
    environment:
      - DB_HOST=database
      - DB_PORT=5432
      - DB_NAME=myapp
      - DB_USER=appuser
      - DB_PASSWORD=secretpass
    depends_on:
      - database
    networks:
      - backend-net
      - frontend-net
    ports:
      - "9000:9000"
    restart: unless-stopped
    volumes:
      - ./app/src:/app/src

  # Serveur web Nginx
  frontend:
    image: nginx:alpine
    container_name: fp-frontend
    volumes:
      - ./web:/usr/share/nginx/html:ro
      - ./nginx.conf:/etc/nginx/nginx.conf:ro
    networks:
      - frontend-net
    ports:
      - "80:80"
    depends_on:
      - backend
    restart: unless-stopped

  # Base de donn√©es PostgreSQL
  database:
    image: postgres:15-alpine
    container_name: fp-database
    environment:
      - POSTGRES_DB=myapp
      - POSTGRES_USER=appuser
      - POSTGRES_PASSWORD=secretpass
    volumes:
      - postgres-data:/var/lib/postgresql/data
      - ./database/init.sql:/docker-entrypoint-initdb.d/init.sql:ro
    networks:
      - backend-net
    ports:
      - "5432:5432"
    restart: unless-stopped
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -U appuser"]
      interval: 10s
      timeout: 5s
      retries: 5

  # Redis pour cache/sessions
  cache:
    image: redis:7-alpine
    container_name: fp-cache
    command: redis-server --appendonly yes
    volumes:
      - redis-data:/data
    networks:
      - backend-net
    ports:
      - "6379:6379"
    restart: unless-stopped

volumes:
  postgres-data:
  redis-data:

networks:
  backend-net:
    driver: bridge
  frontend-net:
    driver: bridge
```

**Commandes de gestion :**

**D√©marrer tous les services :**
```bash
docker compose up -d
```

**Voir l'√©tat des services :**
```bash
docker compose ps
```

**Voir les logs :**
```bash
docker compose logs -f
```

**Logs d'un service sp√©cifique :**
```bash
docker compose logs -f backend
```

**Arr√™ter tous les services :**
```bash
docker compose down
```

**Arr√™ter et supprimer les volumes :**
```bash
docker compose down -v
```

**Reconstruire les images :**
```bash
docker compose build
```

**Red√©marrer un service sp√©cifique :**
```bash
docker compose restart backend
```

**Ex√©cuter une commande dans un service :**
```bash
docker compose exec backend /bin/bash
```

**Mettre √† l'√©chelle un service :**
```bash
docker compose up -d --scale backend=3
```

## S√©curit√© et bonnes pratiques sur Ubuntu

### Utilisateurs non-root dans les conteneurs

**Toujours cr√©er et utiliser un utilisateur d√©di√© :**

```dockerfile
FROM ubuntu:22.04

RUN useradd -m -u 1000 -s /bin/bash appuser

WORKDIR /app
COPY --chown=appuser:appuser . .

USER appuser

CMD ["./monapp"]
```

### Limitation des ressources

**Limiter la m√©moire :**
```bash
docker run -m 512m freepascal-ubuntu:1.0
```

**Limiter le CPU :**
```bash
docker run --cpus="1.5" freepascal-ubuntu:1.0
```

**Limiter les PIDs (processus) :**
```bash
docker run --pids-limit=100 freepascal-ubuntu:1.0
```

### Scan de vuln√©rabilit√©s

**Scanner une image avec Docker Scout (int√©gr√©) :**
```bash
docker scout cves freepascal-ubuntu:1.0
```

**Scanner avec Trivy (outil externe) :**

```bash
# Installation de Trivy
sudo apt-get install wget apt-transport-https gnupg lsb-release
wget -qO - https://aquasecurity.github.io/trivy-repo/deb/public.key | sudo apt-key add -
echo "deb https://aquasecurity.github.io/trivy-repo/deb $(lsb_release -sc) main" | sudo tee /etc/apt/sources.list.d/trivy.list
sudo apt-get update
sudo apt-get install trivy

# Scanner une image
trivy image freepascal-ubuntu:1.0
```

### Isolation avec AppArmor

Ubuntu utilise AppArmor pour confiner les conteneurs.

**V√©rifier le profil AppArmor d'un conteneur :**
```bash
docker inspect <container_id> | grep AppArmor
```

**Utiliser un profil AppArmor custom :**
```bash
docker run --security-opt apparmor=docker-default freepascal-ubuntu:1.0
```

### Secrets et donn√©es sensibles

**Ne jamais mettre de secrets dans les Dockerfiles !**

**Utiliser des variables d'environnement :**
```bash
docker run -e DB_PASSWORD=$(cat /chemin/secret.txt) freepascal-ubuntu:1.0
```

**Ou avec Docker secrets (en mode Swarm) :**
```bash
echo "motdepasse_secret" | docker secret create db_password -
```

**Utiliser un fichier .env avec Docker Compose :**

**Fichier : `.env`**
```env
DB_PASSWORD=secret123
DB_USER=appuser
API_KEY=xyz789
```

**Fichier : `docker-compose.yml`**
```yaml
services:
  app:
    environment:
      - DB_PASSWORD=${DB_PASSWORD}
      - DB_USER=${DB_USER}
```

‚ö†Ô∏è **Important :** Ajoutez `.env` √† votre `.gitignore` !

### Mise √† jour r√©guli√®re des images

**Reconstruire avec les derni√®res mises √† jour :**
```bash
docker build --no-cache -t freepascal-ubuntu:latest .
```

**Mettre √† jour les images de base :**
```bash
docker pull ubuntu:22.04
```

## Optimisation des performances

### Utiliser le cache de build efficacement

Docker met en cache chaque layer. Organisez votre Dockerfile pour maximiser la r√©utilisation du cache.

**Mauvaise pratique (invalidation fr√©quente du cache) :**
```dockerfile
FROM ubuntu:22.04
COPY . /app
RUN apt-get update && apt-get install -y fpc
RUN fpc /app/main.pas
```

**Bonne pratique (cache optimis√©) :**
```dockerfile
FROM ubuntu:22.04

# Installation des d√©pendances (rarement modifi√©, bon cache)
RUN apt-get update && apt-get install -y fpc && rm -rf /var/lib/apt/lists/*

# Copie uniquement le code source (modifi√© fr√©quemment)
COPY main.pas /app/
WORKDIR /app

# Compilation
RUN fpc main.pas
```

### R√©duire la taille des images

**1. Utiliser des images de base l√©g√®res :**
```dockerfile
FROM alpine:latest  # ~5 MB au lieu de Ubuntu ~77 MB
```

**2. Multi-stage builds :**
```dockerfile
# Stage de build
FROM ubuntu:22.04 AS builder
RUN apt-get update && apt-get install -y fpc
COPY . /build
WORKDIR /build
RUN fpc -O3 -XX main.pas

# Stage final minimal
FROM ubuntu:22.04
COPY --from=builder /build/main /app/main
CMD ["/app/main"]
```

**3. Nettoyer apr√®s installation :**
```dockerfile
RUN apt-get update && \
    apt-get install -y fpc && \
    rm -rf /var/lib/apt/lists/* \
    rm -rf /tmp/* \
    rm -rf /var/tmp/*
```

**4. Utiliser .dockerignore :**

**Fichier : `.dockerignore`**
```
.git
.gitignore
*.md
LICENSE
Dockerfile
docker-compose.yml
*.o
*.ppu
*.compiled
backup/
lib/
```

### Optimisation r√©seau

**Utiliser le r√©seau host pour performance maximale (quand appropri√©) :**
```bash
docker run --network host freepascal-web:1.0
```

**Activer IPv6 si n√©cessaire :**

**Fichier : `/etc/docker/daemon.json`**
```json
{
  "ipv6": true,
  "fixed-cidr-v6": "2001:db8:1::/64"
}
```

Puis red√©marrer Docker :
```bash
sudo systemctl restart docker
```

### Optimisation du stockage

**Utiliser overlay2 (normalement par d√©faut) :**

V√©rifier le driver de stockage :
```bash
docker info | grep "Storage Driver"
```

Si ce n'est pas overlay2, configurer :

**Fichier : `/etc/docker/daemon.json`**
```json
{
  "storage-driver": "overlay2"
}
```

**Nettoyage r√©gulier avec cron :**

Cr√©er un script de nettoyage :

**Fichier : `/usr/local/bin/docker-cleanup.sh`**
```bash
#!/bin/bash
docker system prune -af --volumes --filter "until=72h"
```

Rendre ex√©cutable :
```bash
sudo chmod +x /usr/local/bin/docker-cleanup.sh
```

Ajouter √† crontab (ex√©cution hebdomadaire) :
```bash
sudo crontab -e
```

Ajouter :
```
0 2 * * 0 /usr/local/bin/docker-cleanup.sh >> /var/log/docker-cleanup.log 2>&1
```

## Int√©gration CI/CD sur Ubuntu

### GitHub Actions avec Docker

**Fichier : `.github/workflows/docker-build.yml`**

```yaml
name: Build and Test FreePascal Docker

on:
  push:
    branches: [ main, develop ]
  pull_request:
    branches: [ main ]

jobs:
  build:
    runs-on: ubuntu-22.04

    steps:
    - name: Checkout code
      uses: actions/checkout@v3

    - name: Set up Docker Buildx
      uses: docker/setup-buildx-action@v2

    - name: Login to Docker Hub
      uses: docker/login-action@v2
      with:
        username: ${{ secrets.DOCKERHUB_USERNAME }}
        password: ${{ secrets.DOCKERHUB_TOKEN }}

    - name: Build Docker image
      run: |
        docker build -t freepascal-app:${{ github.sha }} .

    - name: Run tests
      run: |
        docker run --rm freepascal-app:${{ github.sha }} ./run_tests.sh

    - name: Push to Docker Hub
      if: github.ref == 'refs/heads/main'
      run: |
        docker tag freepascal-app:${{ github.sha }} username/freepascal-app:latest
        docker push username/freepascal-app:latest
```

### GitLab CI avec Docker

**Fichier : `.gitlab-ci.yml`**

```yaml
stages:
  - build
  - test
  - deploy

variables:
  DOCKER_DRIVER: overlay2
  IMAGE_TAG: $CI_REGISTRY_IMAGE:$CI_COMMIT_SHORT_SHA

before_script:
  - docker login -u $CI_REGISTRY_USER -p $CI_REGISTRY_PASSWORD $CI_REGISTRY

build:
  stage: build
  tags:
    - docker
  script:
    - docker build -t $IMAGE_TAG .
    - docker push $IMAGE_TAG

test:
  stage: test
  tags:
    - docker
  script:
    - docker pull $IMAGE_TAG
    - docker run --rm $IMAGE_TAG ./run_tests.sh

deploy:
  stage: deploy
  tags:
    - docker
  only:
    - main
  script:
    - docker pull $IMAGE_TAG
    - docker tag $IMAGE_TAG $CI_REGISTRY_IMAGE:latest
    - docker push $CI_REGISTRY_IMAGE:latest
    - ssh user@server "docker pull $CI_REGISTRY_IMAGE:latest && docker-compose up -d"
```

### Jenkins Pipeline

**Fichier : `Jenkinsfile`**

```groovy
pipeline {
    agent {
        label 'docker'
    }

    environment {
        DOCKER_IMAGE = 'freepascal-app'
        DOCKER_TAG = "${env.BUILD_NUMBER}"
    }

    stages {
        stage('Build') {
            steps {
                sh "docker build -t ${DOCKER_IMAGE}:${DOCKER_TAG} ."
            }
        }

        stage('Test') {
            steps {
                sh "docker run --rm ${DOCKER_IMAGE}:${DOCKER_TAG} ./run_tests.sh"
            }
        }

        stage('Push') {
            when {
                branch 'main'
            }
            steps {
                withCredentials([usernamePassword(credentialsId: 'dockerhub', usernameVariable: 'USER', passwordVariable: 'PASS')]) {
                    sh "echo $PASS | docker login -u $USER --password-stdin"
                    sh "docker tag ${DOCKER_IMAGE}:${DOCKER_TAG} username/${DOCKER_IMAGE}:latest"
                    sh "docker push username/${DOCKER_IMAGE}:latest"
                }
            }
        }
    }

    post {
        always {
            sh "docker system prune -f"
        }
    }
}
```

## D√©ploiement en production

### D√©ploiement sur un serveur Ubuntu distant

**Script de d√©ploiement : `deploy.sh`**

```bash
#!/bin/bash

# Configuration
REMOTE_USER="deploy"
REMOTE_HOST="production.example.com"
APP_NAME="freepascal-app"
DOCKER_IMAGE="username/${APP_NAME}:latest"

echo "=== D√©ploiement de ${APP_NAME} ==="

# Connexion et d√©ploiement
ssh ${REMOTE_USER}@${REMOTE_HOST} << 'EOF'
    cd /opt/freepascal-app

    # Sauvegarder la configuration
    docker-compose down

    # Mettre √† jour les images
    docker pull username/freepascal-app:latest

    # Red√©marrer les services
    docker-compose up -d

    # V√©rifier l'√©tat
    docker-compose ps

    # Nettoyer les anciennes images
    docker image prune -f
EOF

echo "=== D√©ploiement termin√© ==="
```

### Blue-Green Deployment

**Script : `blue-green-deploy.sh`**

```bash
#!/bin/bash

BLUE_COMPOSE="docker-compose.blue.yml"
GREEN_COMPOSE="docker-compose.green.yml"

# D√©terminer quel environnement est actif
ACTIVE=$(docker ps --filter "name=app-blue" --format "{{.Names}}" | head -n 1)

if [ -z "$ACTIVE" ]; then
    echo "D√©ploiement sur BLUE"
    NEW_ENV="blue"
    OLD_ENV="green"
    NEW_COMPOSE=$BLUE_COMPOSE
    OLD_COMPOSE=$GREEN_COMPOSE
else
    echo "D√©ploiement sur GREEN"
    NEW_ENV="green"
    OLD_ENV="blue"
    NEW_COMPOSE=$GREEN_COMPOSE
    OLD_COMPOSE=$BLUE_COMPOSE
fi

# D√©marrer le nouvel environnement
docker-compose -f $NEW_COMPOSE up -d

# Attendre que les services soient pr√™ts
sleep 10

# Tester le nouvel environnement
HEALTH_CHECK=$(curl -s -o /dev/null -w "%{http_code}" http://localhost:8080/health)

if [ "$HEALTH_CHECK" == "200" ]; then
    echo "Health check OK, basculement du trafic..."

    # Basculer le proxy (exemple avec Nginx)
    # Mettre √† jour la configuration Nginx pour pointer vers le nouvel env

    # Arr√™ter l'ancien environnement
    docker-compose -f $OLD_COMPOSE down

    echo "D√©ploiement $NEW_ENV r√©ussi !"
else
    echo "Health check √©chou√©, rollback..."
    docker-compose -f $NEW_COMPOSE down
    exit 1
fi
```

### Monitoring avec Prometheus

**Fichier : `docker-compose.monitoring.yml`**

```yaml
version: '3.8'

services:
  prometheus:
    image: prom/prometheus:latest
    container_name: prometheus
    volumes:
      - ./prometheus.yml:/etc/prometheus/prometheus.yml
      - prometheus-data:/prometheus
    ports:
      - "9090:9090"
    networks:
      - monitoring
    restart: unless-stopped

  grafana:
    image: grafana/grafana:latest
    container_name: grafana
    environment:
      - GF_SECURITY_ADMIN_PASSWORD=admin
    volumes:
      - grafana-data:/var/lib/grafana
    ports:
      - "3000:3000"
    networks:
      - monitoring
    restart: unless-stopped

  cadvisor:
    image: gcr.io/cadvisor/cadvisor:latest
    container_name: cadvisor
    volumes:
      - /:/rootfs:ro
      - /var/run:/var/run:ro
      - /sys:/sys:ro
      - /var/lib/docker/:/var/lib/docker:ro
    ports:
      - "8080:8080"
    networks:
      - monitoring
    restart: unless-stopped

volumes:
  prometheus-data:
  grafana-data:

networks:
  monitoring:
    driver: bridge
```

**Configuration Prometheus : `prometheus.yml`**

```yaml
global:
  scrape_interval: 15s

scrape_configs:
  - job_name: 'docker'
    static_configs:
      - targets: ['cadvisor:8080']

  - job_name: 'freepascal-app'
    static_configs:
      - targets: ['app:9000']
```

## D√©bogage avanc√©

### Inspecter un conteneur en d√©tail

```bash
docker inspect <container_id>
```

**Extraire des informations sp√©cifiques avec jq :**

```bash
# Adresse IP du conteneur
docker inspect <container_id> | jq '.[0].NetworkSettings.IPAddress'

# Variables d'environnement
docker inspect <container_id> | jq '.[0].Config.Env'

# Volumes mont√©s
docker inspect <container_id> | jq '.[0].Mounts'
```

### Acc√©der aux logs syst√®me Docker

```bash
# Logs du daemon Docker
sudo journalctl -u docker.service -f

# Logs avec filtrage par date
sudo journalctl -u docker.service --since "2024-01-01" --until "2024-01-31"

# Logs d'un conteneur sp√©cifique avec horodatage
docker logs --timestamps <container_id>
```

### Debug avec des outils de tra√ßage

**Installer strace dans un conteneur pour d√©boguer :**

```dockerfile
FROM ubuntu:22.04
RUN apt-get update && apt-get install -y fpc strace
COPY app.pas /app/
WORKDIR /app
RUN fpc app.pas
CMD ["strace", "-f", "./app"]
```

**Analyser les appels syst√®me :**
```bash
docker run freepascal-debug:1.0 2>&1 | grep open
```

### Utiliser Docker events pour surveiller en temps r√©el

```bash
docker events --filter 'type=container'
```

Affiche tous les √©v√©nements des conteneurs en temps r√©el (start, stop, die, etc.).

### Examiner le syst√®me de fichiers d'un conteneur

**Exporter le syst√®me de fichiers :**
```bash
docker export <container_id> > container.tar
tar -xf container.tar
```

**Copier des fichiers depuis/vers un conteneur :**
```bash
# Du conteneur vers l'h√¥te
docker cp <container_id>:/app/logfile.txt ./

# De l'h√¥te vers le conteneur
docker cp ./config.ini <container_id>:/app/
```

## R√©solution des probl√®mes courants

### Probl√®me : "Cannot connect to the Docker daemon"

**Causes possibles :**
1. Le service Docker n'est pas d√©marr√©
2. Votre utilisateur n'est pas dans le groupe docker
3. Socket Docker inaccessible

**Solutions :**

```bash
# V√©rifier et d√©marrer le service
sudo systemctl status docker
sudo systemctl start docker

# Ajouter l'utilisateur au groupe docker
sudo usermod -aG docker $USER
newgrp docker

# V√©rifier les permissions du socket
ls -l /var/run/docker.sock
sudo chmod 666 /var/run/docker.sock
```

### Probl√®me : "No space left on device"

**Causes :** Docker a rempli tout l'espace disque.

**Solutions :**

```bash
# V√©rifier l'utilisation
docker system df

# Nettoyage agressif
docker system prune -a --volumes

# Changer le r√©pertoire de donn√©es Docker
sudo systemctl stop docker
sudo mv /var/lib/docker /mnt/nouveau-disque/docker
sudo ln -s /mnt/nouveau-disque/docker /var/lib/docker
sudo systemctl start docker
```

### Probl√®me : "Error response from daemon: conflict"

**Cause :** Un conteneur avec le m√™me nom existe d√©j√†.

**Solutions :**

```bash
# Lister tous les conteneurs (y compris arr√™t√©s)
docker ps -a

# Supprimer le conteneur existant
docker rm -f <container_name>

# Ou utiliser --rm pour suppression automatique
docker run --rm <image>
```

### Probl√®me : Conteneur qui red√©marre en boucle

**Debug :**

```bash
# Voir les logs
docker logs <container_id>

# Voir les derni√®res lignes
docker logs --tail 50 <container_id>

# Emp√™cher le red√©marrage automatique
docker update --restart=no <container_id>

# Inspecter la politique de red√©marrage
docker inspect <container_id> | grep -A 5 RestartPolicy
```

### Probl√®me : Performances r√©seau lentes

**Solutions :**

```bash
# Utiliser le r√©seau host (si possible)
docker run --network host <image>

# D√©sactiver IPv6 si non utilis√©
echo '{"ipv6": false}' | sudo tee /etc/docker/daemon.json
sudo systemctl restart docker

# Augmenter le MTU
docker network create --opt com.docker.network.driver.mtu=9000 custom-net
```

### Probl√®me : Impossible de se connecter √† un conteneur via son nom

**Cause :** Les conteneurs ne sont pas sur le m√™me r√©seau.

**Solution :**

```bash
# Cr√©er un r√©seau custom
docker network create app-network

# Lancer les conteneurs sur ce r√©seau
docker run --network app-network --name app1 <image1>
docker run --network app-network --name app2 <image2>

# Maintenant app1 et app2 peuvent communiquer par leurs noms
```

## Diff√©rences Ubuntu vs Windows Docker Desktop

### Architecture et performance

| Aspect | Ubuntu (natif) | Windows (Docker Desktop) |
|--------|---------------|-------------------------|
| **Performance** | Native (excellente) | Via WSL 2 ou Hyper-V (bonne) |
| **Overhead** | Minimal | Couche de virtualisation |
| **D√©marrage** | Instantan√© | Quelques secondes |
| **Consommation RAM** | Selon conteneurs | VM + conteneurs |
| **Acc√®s disque** | Direct, rapide | Bind mounts plus lents |

### Commandes et outils

**Ubuntu :**
```bash
# Gestion du service
sudo systemctl start docker
sudo systemctl stop docker
sudo systemctl restart docker

# Logs syst√®me
sudo journalctl -u docker.service

# Configuration
/etc/docker/daemon.json
```

**Windows :**
```powershell
# Via l'interface Docker Desktop
# Pas de commandes systemctl

# Logs via Docker Desktop UI
# Configuration via Settings GUI
```

### Chemins et montages

**Ubuntu :**
```bash
# Chemins absolus Unix
docker run -v /home/user/projet:/app <image>

# Donn√©es Docker
/var/lib/docker/
```

**Windows :**
```powershell
# Chemins Windows ou WSL
docker run -v C:\Users\user\projet:/app <image>
docker run -v /mnt/c/Users/user/projet:/app <image>

# Donn√©es Docker (WSL 2)
\\wsl$\docker-desktop-data\
```

### R√©seau

**Ubuntu :**
- Acc√®s direct aux interfaces r√©seau
- R√©seau host fonctionne parfaitement
- Configuration iptables accessible

**Windows :**
- R√©seau via la VM WSL 2
- Mode host limit√©
- Configuration plus abstraite

## Cas d'usage avanc√©s sp√©cifiques Ubuntu

### Conteneuriser un daemon systemd

Pour ex√©cuter des services systemd dans Docker (utile pour tester des configurations de services) :

**Dockerfile :**
```dockerfile
FROM ubuntu:22.04

ENV container docker

RUN apt-get update && \
    apt-get install -y systemd systemd-sysv fpc && \
    rm -rf /var/lib/apt/lists/*

# Nettoyer systemd
RUN cd /lib/systemd/system/sysinit.target.wants/ && \
    ls | grep -v systemd-tmpfiles-setup | xargs rm -f && \
    rm -f /lib/systemd/system/sockets.target.wants/*udev* && \
    systemctl mask tmp.mount

COPY mon-service.service /etc/systemd/system/
RUN systemctl enable mon-service

VOLUME ["/sys/fs/cgroup"]

CMD ["/lib/systemd/systemd"]
```

**Ex√©cution :**
```bash
docker run -d --privileged \
    -v /sys/fs/cgroup:/sys/fs/cgroup:ro \
    systemd-container
```

### Int√©gration avec LXD

Ubuntu supporte aussi LXD (conteneurs syst√®me complets). Comparaison :

**Docker :** Conteneurs d'applications
**LXD :** Conteneurs syst√®me (mini-VMs)

Vous pouvez utiliser les deux ensemble sur Ubuntu :

```bash
# Installer LXD
sudo snap install lxd
sudo lxd init

# Lancer un conteneur LXD avec Docker dedans
lxc launch ubuntu:22.04 docker-host
lxc exec docker-host -- apt install docker.io
```

### BuildKit avanc√© sur Ubuntu

BuildKit est le constructeur moderne de Docker avec fonctionnalit√©s avanc√©es.

**Activer BuildKit par d√©faut :**

**Fichier : `/etc/docker/daemon.json`**
```json
{
  "features": {
    "buildkit": true
  }
}
```

**Ou pour une commande sp√©cifique :**
```bash
DOCKER_BUILDKIT=1 docker build -t app:latest .
```

**Fonctionnalit√©s avanc√©es BuildKit :**

```dockerfile
# syntax=docker/dockerfile:1.4

FROM ubuntu:22.04

# Montages secrets (ne finissent pas dans l'image)
RUN --mount=type=secret,id=github_token \
    git clone https://$(cat /run/secrets/github_token)@github.com/user/repo.git

# Cache de compilation
RUN --mount=type=cache,target=/root/.cache/fpc \
    fpc mon_gros_projet.pas

# Bind mount (fichiers temporaires)
RUN --mount=type=bind,source=data,target=/data \
    cp /data/config.ini /app/
```

**Utilisation :**
```bash
docker build --secret id=github_token,src=./token.txt -t app:latest .
```

## Ressources et documentation

### Documentation officielle

- **Installation Ubuntu :** [https://docs.docker.com/engine/install/ubuntu/](https://docs.docker.com/engine/install/ubuntu/)
- **Docker Engine API :** [https://docs.docker.com/engine/api/](https://docs.docker.com/engine/api/)
- **Docker Compose :** [https://docs.docker.com/compose/](https://docs.docker.com/compose/)
- **Dockerfile best practices :** [https://docs.docker.com/develop/develop-images/dockerfile_best-practices/](https://docs.docker.com/develop/develop-images/dockerfile_best-practices/)

### Images Docker pour FreePascal/Lazarus

**Images officielles de base :**
- `ubuntu:22.04` - Ubuntu LTS avec support long terme
- `ubuntu:24.04` - Derni√®re version LTS
- `debian:bookworm` - Alternative stable Debian
- `alpine:latest` - Distribution ultra-l√©g√®re

**Installation FreePascal dans diff√©rentes distributions :**

**Ubuntu/Debian :**
```dockerfile
RUN apt-get update && apt-get install -y fpc lazarus
```

**Alpine :**
```dockerfile
RUN apk add --no-cache fpc
```

**Fedora :**
```dockerfile
RUN dnf install -y fpc lazarus
```

### Outils compl√©mentaires utiles

**Portainer** - Interface web pour g√©rer Docker :
```bash
docker volume create portainer_data
docker run -d -p 9000:9000 \
    -v /var/run/docker.sock:/var/run/docker.sock \
    -v portainer_data:/data \
    --restart=always \
    portainer/portainer-ce:latest
```

Acc√©dez √† http://localhost:9000 pour l'interface.

**Watchtower** - Mise √† jour automatique des conteneurs :
```bash
docker run -d \
    --name watchtower \
    -v /var/run/docker.sock:/var/run/docker.sock \
    containrrr/watchtower \
    --cleanup --interval 3600
```

**Dive** - Analyser les layers d'images :
```bash
# Installation
wget https://github.com/wagoodman/dive/releases/download/v0.11.0/dive_0.11.0_linux_amd64.deb
sudo dpkg -i dive_0.11.0_linux_amd64.deb

# Utilisation
dive freepascal-ubuntu:1.0
```

**ctop** - Monitoring temps r√©el des conteneurs :
```bash
sudo wget https://github.com/bcicen/ctop/releases/download/v0.7.7/ctop-0.7.7-linux-amd64 -O /usr/local/bin/ctop
sudo chmod +x /usr/local/bin/ctop
ctop
```

### Communaut√©s et support

**Forums et discussions :**
- Docker Community Forums : [https://forums.docker.com](https://forums.docker.com)
- Ubuntu Discourse : [https://discourse.ubuntu.com](https://discourse.ubuntu.com)
- FreePascal Forum : [https://forum.lazarus.freepascal.org](https://forum.lazarus.freepascal.org)

**Stack Overflow :**
- Tag `docker` : Questions g√©n√©rales Docker
- Tag `freepascal` : Questions FreePascal sp√©cifiques
- Tag `ubuntu` : Probl√®mes li√©s √† Ubuntu

## Conclusion

Docker natif sur Ubuntu offre des performances exceptionnelles et une int√©gration parfaite pour vos applications FreePascal/Lazarus. Vous ma√Ætrisez maintenant :

‚úÖ **Installation et configuration** de Docker sur Ubuntu
‚úÖ **Cr√©ation d'images optimis√©es** pour FreePascal
‚úÖ **Gestion compl√®te** des conteneurs, volumes et r√©seaux
‚úÖ **Docker Compose** pour orchestrer des applications complexes
‚úÖ **Bonnes pratiques de s√©curit√©** et d'optimisation
‚úÖ **Int√©gration CI/CD** avec GitHub Actions, GitLab CI, Jenkins
‚úÖ **D√©ploiement en production** avec strat√©gies avanc√©es
‚úÖ **Monitoring et d√©bogage** d'applications conteneuris√©es
‚úÖ **R√©solution de probl√®mes** courants
‚úÖ **Diff√©rences Windows/Ubuntu** pour mieux adapter vos workflows

### Prochaines √©tapes

Maintenant que vous ma√Ætrisez Docker sur Ubuntu (et Windows via la section pr√©c√©dente 22.1.1), vous √™tes pr√™t pour :

**Section 22.2 - Orchestration Kubernetes** : G√©rer des centaines de conteneurs √† grande √©chelle

**Section 22.3 - Infrastructure as Code** : Automatiser compl√®tement votre infrastructure avec Terraform et Ansible

**Section 22.4 - Pipelines CI/CD** : Approfondir l'automatisation de bout en bout

### Conseils finaux

**Pour bien progresser avec Docker :**

1. **Pratiquez r√©guli√®rement** - Cr√©ez des conteneurs pour tous vos projets FreePascal
2. **Exp√©rimentez** - Docker est s√ªr, vous ne pouvez rien casser sur votre syst√®me h√¥te
3. **Automatisez** - Chaque t√¢che r√©p√©titive devrait √™tre dans un script ou Dockerfile
4. **Partagez** - Publiez vos images utiles sur Docker Hub pour la communaut√©
5. **Documentez** - Commentez vos Dockerfiles et docker-compose.yml
6. **Surveillez** - Gardez un ≈ìil sur l'utilisation des ressources
7. **Mettez √† jour** - Gardez Docker et vos images √† jour

### Projet pratique sugg√©r√©

Pour consolider vos connaissances, cr√©ez une application FreePascal compl√®te avec :

- **Frontend** : Application LCL avec interface GTK
- **Backend** : API REST en FreePascal
- **Base de donn√©es** : PostgreSQL
- **Cache** : Redis
- **Proxy** : Nginx
- **Monitoring** : Prometheus + Grafana

Tout orchestr√© avec Docker Compose, d√©ploy√© via CI/CD, et document√© dans un README.

**Bonne conteneurisation avec FreePascal et Ubuntu ! üê≥üêß**

‚è≠Ô∏è [Orchestration Kubernetes](/22-devops-deploiement-multi-os/02-orchestration-kubernetes.md)
