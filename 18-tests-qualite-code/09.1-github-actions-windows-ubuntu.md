üîù Retour au [Sommaire](/SOMMAIRE.md)

# 18.9.1 GitHub Actions Windows/Ubuntu

## Introduction √† l'Int√©gration Continue avec GitHub Actions

### Qu'est-ce que GitHub Actions ?

GitHub Actions est un service d'int√©gration continue et de d√©ploiement continu (CI/CD) int√©gr√© directement √† GitHub. Il permet d'automatiser des t√¢ches comme :

- **Compiler votre code** automatiquement √† chaque modification
- **Ex√©cuter les tests** pour v√©rifier que rien n'est cass√©
- **V√©rifier la qualit√© du code** (linting, analyse statique)
- **D√©ployer l'application** automatiquement sur les serveurs
- **G√©n√©rer des rapports** de couverture de code
- **Cr√©er des releases** et des packages

### Pourquoi utiliser GitHub Actions pour FreePascal ?

**Avantages :**

‚úÖ **Gratuit pour les projets open source** (et g√©n√©reux pour les projets priv√©s)
‚úÖ **Int√©gr√© √† GitHub** : pas besoin de service externe
‚úÖ **Multi-plateforme** : teste facilement sur Windows, Linux et macOS
‚úÖ **Parall√©lisation** : teste sur plusieurs OS simultan√©ment
‚úÖ **Automatisation compl√®te** : moins d'erreurs humaines
‚úÖ **Historique des builds** : trace de toutes les compilations

**Cas d'usage typiques :**

1. **D√©veloppeur solo** : v√©rifier que le code compile sur les deux OS
2. **√âquipe** : s'assurer qu'un commit ne casse pas le build
3. **Projet open source** : garantir la qualit√© avant d'accepter une Pull Request
4. **Production** : d√©ployer automatiquement apr√®s validation

---

## Concepts de Base

### Anatomie d'un Workflow GitHub Actions

Un workflow GitHub Actions est d√©fini dans un fichier YAML situ√© dans `.github/workflows/`.

**Structure de base :**

```yaml
name: Nom du Workflow          # Nom affich√© dans l'interface
on: [push, pull_request]       # Quand le workflow se d√©clenche
jobs:                          # Liste des t√¢ches √† ex√©cuter
  build:                       # Nom du job
    runs-on: ubuntu-latest     # Sur quel OS ex√©cuter
    steps:                     # Liste des √©tapes
      - name: Premi√®re √©tape   # Nom de l'√©tape
        run: echo "Hello"      # Commande √† ex√©cuter
```

### √âl√©ments Cl√©s

#### 1. D√©clencheurs (Triggers)

**Les √©v√©nements qui lancent le workflow :**

```yaml
# D√©clencher sur push
on: push

# D√©clencher sur plusieurs √©v√©nements
on: [push, pull_request]

# D√©clencher sur des branches sp√©cifiques
on:
  push:
    branches:
      - main
      - develop
  pull_request:
    branches:
      - main
```

#### 2. Jobs

**Unit√©s de travail qui s'ex√©cutent (par d√©faut en parall√®le) :**

```yaml
jobs:
  build-windows:
    runs-on: windows-latest
    steps:
      - name: Compilation Windows
        run: fpc MonProgramme.pas

  build-linux:
    runs-on: ubuntu-latest
    steps:
      - name: Compilation Linux
        run: fpc MonProgramme.pas
```

Ces deux jobs s'ex√©cutent **en parall√®le** sur deux machines virtuelles diff√©rentes.

#### 3. Steps (√âtapes)

**Actions individuelles dans un job :**

```yaml
steps:
  - name: R√©cup√©rer le code
    uses: actions/checkout@v3

  - name: Installer FreePascal
    run: sudo apt install fpc

  - name: Compiler
    run: fpc MonProgramme.pas
```

#### 4. Runners (Machines d'Ex√©cution)

**OS disponibles :**

- `ubuntu-latest` (Ubuntu 22.04)
- `ubuntu-20.04` (version sp√©cifique)
- `windows-latest` (Windows Server 2022)
- `windows-2019` (version sp√©cifique)
- `macos-latest` (macOS 12+)

---

## Installation de FreePascal dans GitHub Actions

### Sur Ubuntu

```yaml
jobs:
  build-ubuntu:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout du code
        uses: actions/checkout@v3

      - name: Installer FreePascal
        run: |
          sudo apt-get update
          sudo apt-get install -y fpc

      - name: V√©rifier l'installation
        run: fpc -iV
```

**Explication :**
- `sudo apt-get update` : met √† jour la liste des packages
- `sudo apt-get install -y fpc` : installe FreePascal (l'option `-y` √©vite la confirmation)
- `fpc -iV` : affiche la version install√©e

### Sur Windows

```yaml
jobs:
  build-windows:
    runs-on: windows-latest
    steps:
      - name: Checkout du code
        uses: actions/checkout@v3

      - name: Installer FreePascal avec Chocolatey
        run: choco install freepascal -y

      - name: V√©rifier l'installation
        run: fpc -iV
```

**Explication :**
- `choco install freepascal -y` : utilise Chocolatey (gestionnaire de packages Windows)
- L'option `-y` accepte automatiquement les confirmations

### Installation de Lazarus (si n√©cessaire)

#### Ubuntu
```yaml
- name: Installer Lazarus
  run: |
    sudo apt-get install -y lazarus lcl
```

#### Windows
```yaml
- name: Installer Lazarus
  run: choco install lazarus -y
```

---

## Premier Workflow Complet : Build Multi-Plateforme

### Cr√©er le Fichier de Workflow

**Emplacement :** `.github/workflows/build.yml`

```yaml
name: Build FreePascal Multi-Plateforme

on:
  push:
    branches: [ main, develop ]
  pull_request:
    branches: [ main ]

jobs:
  # Job 1: Compilation sur Ubuntu
  build-ubuntu:
    runs-on: ubuntu-latest

    steps:
    - name: R√©cup√©ration du code source
      uses: actions/checkout@v3

    - name: Installation de FreePascal
      run: |
        sudo apt-get update
        sudo apt-get install -y fpc

    - name: Affichage de la version FPC
      run: fpc -iV

    - name: Compilation du projet
      run: |
        cd src
        fpc -O2 -gl MonProgramme.pas

    - name: V√©rification de l'ex√©cutable
      run: |
        test -f src/MonProgramme
        echo "‚úÖ Compilation Ubuntu r√©ussie"

  # Job 2: Compilation sur Windows
  build-windows:
    runs-on: windows-latest

    steps:
    - name: R√©cup√©ration du code source
      uses: actions/checkout@v3

    - name: Installation de FreePascal
      run: choco install freepascal -y

    - name: Affichage de la version FPC
      run: fpc -iV

    - name: Compilation du projet
      run: |
        cd src
        fpc -O2 -gl MonProgramme.pas

    - name: V√©rification de l'ex√©cutable
      run: |
        if (Test-Path src\MonProgramme.exe) {
          Write-Host "‚úÖ Compilation Windows r√©ussie"
        } else {
          Write-Error "‚ùå Ex√©cutable non trouv√©"
          exit 1
        }
      shell: pwsh
```

### Comprendre ce Workflow

**D√©clencheurs :**
- S'ex√©cute sur chaque `push` vers les branches `main` ou `develop`
- S'ex√©cute sur chaque `pull_request` vers `main`

**Deux jobs en parall√®le :**
1. **build-ubuntu** : compile sur Ubuntu
2. **build-windows** : compile sur Windows

**√âtapes communes :**
1. R√©cup√®re le code avec `actions/checkout@v3`
2. Installe FreePascal (diff√©remment selon l'OS)
3. Affiche la version pour v√©rification
4. Compile le projet
5. V√©rifie que l'ex√©cutable existe

---

## Workflow Avanc√© : Tests Automatiques

### Avec FPCUnit

```yaml
name: Tests FPCUnit

on: [push, pull_request]

jobs:
  test-ubuntu:
    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@v3

    - name: Installation FPC et FPCUnit
      run: |
        sudo apt-get update
        sudo apt-get install -y fpc fpcunit

    - name: Compilation des tests
      run: |
        cd tests
        fpc -Fu../src -gl TestsSuite.pas

    - name: Ex√©cution des tests
      run: |
        cd tests
        ./TestsSuite --format=plain

    - name: V√©rification du r√©sultat
      run: |
        if [ $? -eq 0 ]; then
          echo "‚úÖ Tous les tests passent"
        else
          echo "‚ùå Des tests ont √©chou√©"
          exit 1
        fi

  test-windows:
    runs-on: windows-latest

    steps:
    - uses: actions/checkout@v3

    - name: Installation FPC
      run: choco install freepascal -y

    - name: Compilation des tests
      run: |
        cd tests
        fpc -Fu..\src -gl TestsSuite.pas

    - name: Ex√©cution des tests
      run: |
        cd tests
        .\TestsSuite.exe --format=plain

    - name: V√©rification du r√©sultat
      shell: pwsh
      run: |
        if ($LASTEXITCODE -eq 0) {
          Write-Host "‚úÖ Tous les tests passent"
        } else {
          Write-Error "‚ùå Des tests ont √©chou√©"
          exit 1
        }
```

---

## Matrice de Build : Tester Plusieurs Configurations

### Concept de Matrice

Une matrice permet de tester automatiquement plusieurs combinaisons de param√®tres (OS, versions, options).

### Exemple : Plusieurs Versions de FreePascal

```yaml
name: Matrice Multi-Versions

on: [push, pull_request]

jobs:
  build:
    strategy:
      matrix:
        os: [ubuntu-latest, windows-latest]
        fpc-version: ['3.2.0', '3.2.2']

    runs-on: ${{ matrix.os }}

    steps:
    - uses: actions/checkout@v3

    - name: Installation FPC ${{ matrix.fpc-version }} sur ${{ matrix.os }}
      if: runner.os == 'Linux'
      run: |
        # Script d'installation selon la version
        echo "Installation de FPC ${{ matrix.fpc-version }}"
        sudo apt-get update
        sudo apt-get install -y fpc

    - name: Installation FPC ${{ matrix.fpc-version }} sur ${{ matrix.os }}
      if: runner.os == 'Windows'
      run: choco install freepascal -y

    - name: Compilation
      run: fpc -O2 MonProgramme.pas
```

**R√©sultat :** Ce workflow cr√©e **4 jobs** automatiquement :
1. Ubuntu + FPC 3.2.0
2. Ubuntu + FPC 3.2.2
3. Windows + FPC 3.2.0
4. Windows + FPC 3.2.2

### Matrice avec Exclusions

```yaml
strategy:
  matrix:
    os: [ubuntu-latest, windows-latest, macos-latest]
    fpc-version: ['3.2.0', '3.2.2']
    exclude:
      # Exclure macOS + FPC 3.2.0 (non support√©)
      - os: macos-latest
        fpc-version: '3.2.0'
```

---

## Gestion des Artefacts (Artifacts)

### Qu'est-ce qu'un Artefact ?

Un artefact est un fichier g√©n√©r√© par votre workflow (ex√©cutable, rapport, logs) que vous pouvez t√©l√©charger ou r√©utiliser.

### Sauvegarder les Ex√©cutables

```yaml
name: Build et Sauvegarde des Ex√©cutables

on: [push]

jobs:
  build-and-upload:
    strategy:
      matrix:
        os: [ubuntu-latest, windows-latest]

    runs-on: ${{ matrix.os }}

    steps:
    - uses: actions/checkout@v3

    - name: Installer FPC
      run: |
        if [ "$RUNNER_OS" == "Linux" ]; then
          sudo apt-get update && sudo apt-get install -y fpc
        elif [ "$RUNNER_OS" == "Windows" ]; then
          choco install freepascal -y
        fi
      shell: bash

    - name: Compiler
      run: fpc -O2 MonProgramme.pas

    - name: Upload de l'ex√©cutable Ubuntu
      if: runner.os == 'Linux'
      uses: actions/upload-artifact@v3
      with:
        name: MonProgramme-Linux
        path: MonProgramme

    - name: Upload de l'ex√©cutable Windows
      if: runner.os == 'Windows'
      uses: actions/upload-artifact@v3
      with:
        name: MonProgramme-Windows
        path: MonProgramme.exe
```

**R√©sultat :** Apr√®s le build, vous pouvez t√©l√©charger `MonProgramme-Linux` et `MonProgramme-Windows` depuis l'interface GitHub Actions.

### T√©l√©charger un Artefact dans un Autre Job

```yaml
jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - name: Compiler
        run: fpc MonProgramme.pas
      - name: Upload
        uses: actions/upload-artifact@v3
        with:
          name: executable
          path: MonProgramme

  test:
    needs: build  # Attend que 'build' soit termin√©
    runs-on: ubuntu-latest
    steps:
      - name: T√©l√©charger l'ex√©cutable
        uses: actions/download-artifact@v3
        with:
          name: executable

      - name: Rendre ex√©cutable
        run: chmod +x MonProgramme

      - name: Ex√©cuter les tests
        run: ./MonProgramme --run-tests
```

---

## Workflows Conditionnels

### Ex√©cuter Seulement sur Certaines Branches

```yaml
name: Deploy Production

on:
  push:
    branches:
      - main  # Seulement sur la branche main

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - name: D√©ploiement
        run: echo "D√©ploiement en production"
```

### Conditions au Niveau des Steps

```yaml
steps:
  - name: √âtape qui s'ex√©cute seulement sur Linux
    if: runner.os == 'Linux'
    run: echo "Je suis sur Linux"

  - name: √âtape qui s'ex√©cute seulement sur Windows
    if: runner.os == 'Windows'
    run: echo "Je suis sur Windows"

  - name: √âtape qui s'ex√©cute seulement sur la branche main
    if: github.ref == 'refs/heads/main'
    run: echo "Je suis sur main"

  - name: √âtape qui s'ex√©cute seulement sur les tags
    if: startsWith(github.ref, 'refs/tags/')
    run: echo "C'est un tag de version"
```

### Ex√©cuter sur Pull Request Uniquement

```yaml
name: Validation PR

on:
  pull_request:
    types: [opened, synchronize, reopened]

jobs:
  validate:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - name: V√©rifier le code
        run: |
          fpc -gl -Ci src/*.pas
          echo "‚úÖ Code valide"
```

---

## Cache pour Acc√©l√©rer les Builds

### Mise en Cache des D√©pendances

Le cache permet de r√©utiliser des fichiers entre les ex√©cutions pour gagner du temps.

```yaml
name: Build avec Cache

on: [push]

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@v3

    - name: Cache des packages FPC
      uses: actions/cache@v3
      with:
        path: |
          ~/.fpc
          /usr/lib/fpc
        key: ${{ runner.os }}-fpc-${{ hashFiles('**/fpc.cfg') }}
        restore-keys: |
          ${{ runner.os }}-fpc-

    - name: Installer FPC
      run: sudo apt-get install -y fpc

    - name: Compiler
      run: fpc -O2 MonProgramme.pas
```

**Avantages :**
- Premier build : installe FPC normalement (~2 minutes)
- Builds suivants : utilise le cache (~10 secondes)

---

## Variables d'Environnement et Secrets

### Variables d'Environnement

```yaml
jobs:
  build:
    runs-on: ubuntu-latest

    env:
      FPC_VERSION: 3.2.2
      BUILD_CONFIG: Release

    steps:
    - name: Utiliser les variables
      run: |
        echo "Version FPC: $FPC_VERSION"
        echo "Configuration: $BUILD_CONFIG"
        fpc -O2 -dRELEASE MonProgramme.pas
```

### Secrets (Donn√©es Sensibles)

**Pour stocker des mots de passe, cl√©s API, etc.**

**1. Ajouter un secret dans GitHub :**
- Allez dans `Settings ‚Üí Secrets and variables ‚Üí Actions`
- Cliquez sur `New repository secret`
- Nom : `DEPLOY_TOKEN`, Valeur : `votre_token_secret`

**2. Utiliser le secret dans le workflow :**

```yaml
jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
    - name: D√©ployer avec token
      run: |
        echo "D√©ploiement avec token s√©curis√©"
        curl -H "Authorization: Bearer ${{ secrets.DEPLOY_TOKEN }}" \
             https://api.example.com/deploy
```

**Important :** Les secrets ne sont JAMAIS affich√©s dans les logs !

---

## Workflow Complet : Pipeline CI/CD Professionnel

### Structure du Projet

```
mon-projet/
‚îú‚îÄ‚îÄ .github/
‚îÇ   ‚îî‚îÄ‚îÄ workflows/
‚îÇ       ‚îî‚îÄ‚îÄ ci-cd.yml
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îî‚îÄ‚îÄ MonProgramme.pas
‚îú‚îÄ‚îÄ tests/
‚îÇ   ‚îî‚îÄ‚îÄ TestsSuite.pas
‚îî‚îÄ‚îÄ README.md
```

### Fichier ci-cd.yml Complet

```yaml
name: Pipeline CI/CD FreePascal

on:
  push:
    branches: [ main, develop ]
    tags:
      - 'v*'
  pull_request:
    branches: [ main ]

env:
  FPC_VERSION: 3.2.2

jobs:
  # Job 1: V√©rification du code
  lint:
    name: Analyse statique du code
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3

      - name: Installer FPC
        run: |
          sudo apt-get update
          sudo apt-get install -y fpc

      - name: V√©rifier la syntaxe
        run: |
          find src -name "*.pas" -exec fpc -S {} \;

  # Job 2: Build multi-plateforme
  build:
    name: Compilation ${{ matrix.os }}
    needs: lint
    strategy:
      fail-fast: false
      matrix:
        os: [ubuntu-latest, windows-latest]
        include:
          - os: ubuntu-latest
            executable: MonProgramme
          - os: windows-latest
            executable: MonProgramme.exe

    runs-on: ${{ matrix.os }}

    steps:
      - uses: actions/checkout@v3

      - name: Installer FPC (Linux)
        if: runner.os == 'Linux'
        run: |
          sudo apt-get update
          sudo apt-get install -y fpc

      - name: Installer FPC (Windows)
        if: runner.os == 'Windows'
        run: choco install freepascal -y

      - name: Compiler le projet
        run: |
          cd src
          fpc -O2 -gl -Ci MonProgramme.pas

      - name: Upload de l'ex√©cutable
        uses: actions/upload-artifact@v3
        with:
          name: MonProgramme-${{ runner.os }}
          path: src/${{ matrix.executable }}

  # Job 3: Tests automatiques
  test:
    name: Tests ${{ matrix.os }}
    needs: build
    strategy:
      matrix:
        os: [ubuntu-latest, windows-latest]

    runs-on: ${{ matrix.os }}

    steps:
      - uses: actions/checkout@v3

      - name: T√©l√©charger l'ex√©cutable
        uses: actions/download-artifact@v3
        with:
          name: MonProgramme-${{ runner.os }}
          path: ./bin

      - name: Rendre ex√©cutable (Linux)
        if: runner.os == 'Linux'
        run: chmod +x bin/MonProgramme

      - name: Installer FPC
        run: |
          if [ "$RUNNER_OS" == "Linux" ]; then
            sudo apt-get update && sudo apt-get install -y fpc fpcunit
          elif [ "$RUNNER_OS" == "Windows" ]; then
            choco install freepascal -y
          fi
        shell: bash

      - name: Compiler les tests
        run: |
          cd tests
          fpc -Fu../src -gl TestsSuite.pas

      - name: Ex√©cuter les tests
        run: |
          cd tests
          if [ "$RUNNER_OS" == "Linux" ]; then
            ./TestsSuite --format=plain
          else
            ./TestsSuite.exe --format=plain
          fi
        shell: bash

  # Job 4: Release automatique (seulement sur tags)
  release:
    name: Cr√©er une Release
    if: startsWith(github.ref, 'refs/tags/v')
    needs: [build, test]
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v3

      - name: T√©l√©charger tous les artefacts
        uses: actions/download-artifact@v3

      - name: Cr√©er l'archive Linux
        run: |
          cd MonProgramme-Linux
          tar -czf ../MonProgramme-Linux-${{ github.ref_name }}.tar.gz *

      - name: Cr√©er l'archive Windows
        run: |
          cd MonProgramme-Windows
          zip -r ../MonProgramme-Windows-${{ github.ref_name }}.zip *

      - name: Cr√©er la Release GitHub
        uses: softprops/action-gh-release@v1
        with:
          files: |
            MonProgramme-Linux-${{ github.ref_name }}.tar.gz
            MonProgramme-Windows-${{ github.ref_name }}.zip
          draft: false
          prerelease: false
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
```

### Fonctionnalit√©s de ce Pipeline

**1. Analyse statique** (`lint`)
- V√©rifie la syntaxe de tous les fichiers `.pas`
- S'ex√©cute en premier pour d√©tecter rapidement les erreurs

**2. Compilation multi-plateforme** (`build`)
- Compile sur Ubuntu et Windows en parall√®le
- Sauvegarde les ex√©cutables comme artefacts
- Utilise une matrice pour √©viter la duplication

**3. Tests automatiques** (`test`)
- T√©l√©charge les ex√©cutables compil√©s
- Compile et ex√©cute la suite de tests FPCUnit
- Valide sur les deux plateformes

**4. Release automatique** (`release`)
- S'ex√©cute seulement quand vous cr√©ez un tag (ex: `v1.0.0`)
- Cr√©e des archives `.tar.gz` et `.zip`
- Publie automatiquement une Release GitHub avec les binaires

---

## Badge de Statut dans le README

Ajoutez un badge pour montrer l'√©tat de votre build :

```markdown
# Mon Projet FreePascal

![Build Status](https://github.com/username/repo/workflows/CI-CD/badge.svg)
```

Le badge affichera :
- ‚úÖ Vert si le build passe
- ‚ùå Rouge si le build √©choue
- üü° Jaune si le build est en cours

---

## D√©bogage des Workflows

### Afficher des Informations de Debug

```yaml
steps:
  - name: Debug - Informations syst√®me
    run: |
      echo "OS: $RUNNER_OS"
      echo "Architecture: $RUNNER_ARCH"
      echo "Workspace: $GITHUB_WORKSPACE"
      echo "Branch: $GITHUB_REF"
      echo "Commit: $GITHUB_SHA"

  - name: Debug - Lister les fichiers
    run: |
      ls -la
      pwd
```

### Activer le Mode Debug

Dans GitHub :
1. Allez dans `Settings ‚Üí Secrets and variables ‚Üí Actions`
2. Ajoutez deux secrets :
   - `ACTIONS_RUNNER_DEBUG` = `true`
   - `ACTIONS_STEP_DEBUG` = `true`

Les logs afficheront beaucoup plus de d√©tails.

### Tester Localement avec act

`act` permet d'ex√©cuter GitHub Actions localement :

```bash
# Installation (Linux)
curl https://raw.githubusercontent.com/nektos/act/master/install.sh | sudo bash

# Ex√©cuter le workflow localement
act -j build
```

---

## Bonnes Pratiques

### 1. Nommer Clairement les Jobs et Steps

‚ùå **Mauvais :**
```yaml
steps:
  - name: Step 1
    run: fpc test.pas
```

‚úÖ **Bon :**
```yaml
steps:
  - name: Compilation des tests unitaires
    run: fpc -Fu../src tests/TestsSuite.pas
```

### 2. Utiliser fail-fast Intelligemment

```yaml
strategy:
  fail-fast: false  # Continue m√™me si un job √©choue
  matrix:
    os: [ubuntu-latest, windows-latest]
```

Sans `fail-fast: false`, si Windows √©choue, Ubuntu est annul√© automatiquement.

### 3. S√©parer Build et Test

```yaml
jobs:
  build:
    # Compile le code

  test:
    needs: build  # Attend la fin du build
    # Ex√©cute les tests
```

Avantage : en cas d'√©chec de compilation, les tests ne s'ex√©cutent pas inutilement.

### 4. Versionner les Actions

‚úÖ **Bon :**
```yaml
- uses: actions/checkout@v3  # Version fixe
```

‚ùå **Risqu√© :**
```yaml
- uses: actions/checkout@main  # Peut changer sans pr√©venir
```

### 5. Nettoyer les Artefacts

Les artefacts consomment de l'espace de stockage :

```yaml
- name: Upload de l'ex√©cutable
  uses: actions/upload-artifact@v3
  with:
    name: executable
    path: MonProgramme
    retention-days: 7  # Supprimer apr√®s 7 jours
```

### 6. Utiliser des Scripts pour le Code Complexe

Au lieu de mettre beaucoup de lignes `run:`, cr√©ez un script :

**scripts/build.sh :**
```bash
#!/bin/bash
set -e

echo "Compilation en cours..."
cd src
fpc -O2 -gl MonProgramme.pas
echo "‚úÖ Compilation r√©ussie"
```

**Workflow :**
```yaml
steps:
  - name: Compiler
    run: bash scripts/build.sh
```

---

## Limites et Quotas

### Limites Gratuites (par mois)

| Type de Compte | Minutes Gratuites | Espace Artefacts |
|----------------|-------------------|------------------|
| Public (open source) | Illimit√© | 500 MB |
| Priv√© (Free) | 2000 minutes | 500 MB |
| Priv√© (Pro) | 3000 minutes | 1 GB |
| Priv√© (Team) | 3000 minutes | 2 GB |

### Multiplicateurs par OS

| OS | Multiplicateur |
|----|----------------|
| Linux | 1x |
| Windows | 2x |
| macOS | 10x |

**Exemple :** Un build de 10 minutes sur Windows compte comme **20 minutes**.

### Optimiser la Consommation

1. **Utiliser le cache** pour r√©duire les temps de build
2. **Privil√©gier Linux** quand c'est possible
3. **Parall√©liser intelligemment** sans abus
4. **Nettoyer les artefacts** r√©guli√®rement

---

## Cas d'Usage Avanc√©s

### Build Conditionnel selon le Message de Commit

```yaml
jobs:
  build:
    if: "!contains(github.event.head_commit.message, '[skip ci]')"
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - name: Build
        run: fpc MonProgramme.pas
```

Si votre commit contient `[skip ci]`, le build est ignor√©.

### Notifications Slack/Discord

```yaml
jobs:
  notify:
    runs-on: ubuntu-latest
    if: always()  # S'ex√©cute m√™me si les autres jobs √©chouent
    needs: [build, test]
    steps:
      - name: Notifier sur Discord
        if: failure()
        run: |
          curl -X POST ${{ secrets.DISCORD_WEBHOOK }} \
            -H "Content-Type: application/json" \
            -d '{"content":"‚ùå Build √©chou√© pour ${{ github.repository }}"}'

      - name: Notifier sur Slack
        if: success()
        run: |
          curl -X POST ${{ secrets.SLACK_WEBHOOK }} \
            -H "Content-Type: application/json" \
            -d '{
              "text": "‚úÖ Build r√©ussi pour ${{ github.repository }}",
              "attachments": [{
                "color": "good",
                "fields": [{
                  "title": "Branche",
                  "value": "${{ github.ref_name }}",
                  "short": true
                }, {
                  "title": "Commit",
                  "value": "${{ github.sha }}",
                  "short": true
                }]
              }]
            }'
```

**Configuration :**
1. Cr√©ez un webhook dans Discord/Slack
2. Ajoutez-le comme secret : `DISCORD_WEBHOOK` ou `SLACK_WEBHOOK`
3. Le workflow envoie automatiquement des notifications

---

## D√©ploiement Automatique

### D√©ploiement sur un Serveur Linux via SSH

```yaml
name: D√©ploiement Production

on:
  push:
    branches:
      - main
    tags:
      - 'v*'

jobs:
  deploy:
    name: D√©ployer sur serveur Linux
    runs-on: ubuntu-latest

    steps:
      - name: Checkout du code
        uses: actions/checkout@v3

      - name: Installer FreePascal
        run: |
          sudo apt-get update
          sudo apt-get install -y fpc

      - name: Compiler pour production
        run: |
          cd src
          fpc -O3 -XXs -CX MonProgramme.pas

      - name: Cr√©er l'archive de d√©ploiement
        run: |
          mkdir -p deploy
          cp src/MonProgramme deploy/
          cp -r config deploy/
          tar -czf deploy.tar.gz deploy/

      - name: D√©ployer via SSH
        uses: appleboy/scp-action@master
        with:
          host: ${{ secrets.DEPLOY_HOST }}
          username: ${{ secrets.DEPLOY_USER }}
          key: ${{ secrets.DEPLOY_SSH_KEY }}
          source: "deploy.tar.gz"
          target: "/tmp/"

      - name: Extraire et red√©marrer le service
        uses: appleboy/ssh-action@master
        with:
          host: ${{ secrets.DEPLOY_HOST }}
          username: ${{ secrets.DEPLOY_USER }}
          key: ${{ secrets.DEPLOY_SSH_KEY }}
          script: |
            cd /opt/monapp
            sudo systemctl stop monapp
            tar -xzf /tmp/deploy.tar.gz
            cp -r deploy/* .
            sudo systemctl start monapp
            sudo systemctl status monapp
            rm -rf /tmp/deploy.tar.gz deploy/
```

**Secrets n√©cessaires :**
- `DEPLOY_HOST` : IP ou nom d'h√¥te du serveur
- `DEPLOY_USER` : Nom d'utilisateur SSH
- `DEPLOY_SSH_KEY` : Cl√© priv√©e SSH (format PEM)

### D√©ploiement sur un Serveur Windows

```yaml
jobs:
  deploy-windows:
    name: D√©ployer sur serveur Windows
    runs-on: windows-latest

    steps:
      - uses: actions/checkout@v3

      - name: Compiler
        run: |
          choco install freepascal -y
          cd src
          fpc -O3 MonProgramme.pas

      - name: Copier vers le serveur
        run: |
          # Utiliser WinSCP ou PowerShell Remoting
          $secPassword = ConvertTo-SecureString "${{ secrets.DEPLOY_PASSWORD }}" -AsPlainText -Force
          $credential = New-Object System.Management.Automation.PSCredential("${{ secrets.DEPLOY_USER }}", $secPassword)

          $session = New-PSSession -ComputerName ${{ secrets.DEPLOY_HOST }} -Credential $credential

          Copy-Item -Path "src\MonProgramme.exe" `
                    -Destination "C:\Apps\MonApp\" `
                    -ToSession $session

          Invoke-Command -Session $session -ScriptBlock {
            Stop-Service -Name "MonAppService"
            Start-Service -Name "MonAppService"
          }

          Remove-PSSession $session
        shell: pwsh
```

---

## D√©ploiement Docker Multi-Plateforme

### Cr√©er et Publier des Images Docker

```yaml
name: Docker Build et Push

on:
  push:
    branches: [ main ]
    tags: [ 'v*' ]

env:
  REGISTRY: ghcr.io
  IMAGE_NAME: ${{ github.repository }}

jobs:
  build-docker:
    runs-on: ubuntu-latest
    permissions:
      contents: read
      packages: write

    steps:
      - name: Checkout
        uses: actions/checkout@v3

      - name: Setup Docker Buildx
        uses: docker/setup-buildx-action@v2

      - name: Login vers GitHub Container Registry
        uses: docker/login-action@v2
        with:
          registry: ${{ env.REGISTRY }}
          username: ${{ github.actor }}
          password: ${{ secrets.GITHUB_TOKEN }}

      - name: Extract metadata
        id: meta
        uses: docker/metadata-action@v4
        with:
          images: ${{ env.REGISTRY }}/${{ env.IMAGE_NAME }}
          tags: |
            type=ref,event=branch
            type=semver,pattern={{version}}
            type=semver,pattern={{major}}.{{minor}}

      - name: Build et Push image Docker
        uses: docker/build-push-action@v4
        with:
          context: .
          platforms: linux/amd64,linux/arm64
          push: true
          tags: ${{ steps.meta.outputs.tags }}
          labels: ${{ steps.meta.outputs.labels }}
          cache-from: type=gha
          cache-to: type=gha,mode=max
```

**Dockerfile FreePascal :**

```dockerfile
# Dockerfile
FROM ubuntu:22.04 as builder

# Installer FreePascal
RUN apt-get update && \
    apt-get install -y fpc && \
    rm -rf /var/lib/apt/lists/*

WORKDIR /build

# Copier le code source
COPY src/ ./src/

# Compiler
RUN cd src && fpc -O3 -XXs MonProgramme.pas

# Image finale l√©g√®re
FROM ubuntu:22.04

RUN apt-get update && \
    apt-get install -y ca-certificates && \
    rm -rf /var/lib/apt/lists/*

WORKDIR /app

# Copier l'ex√©cutable compil√©
COPY --from=builder /build/src/MonProgramme .

# Copier les fichiers de configuration
COPY config/ ./config/

# Exposition du port (si applicable)
EXPOSE 8080

# Commande de d√©marrage
CMD ["./MonProgramme"]
```

---

## Tests de Performance Automatis√©s

### Benchmark et Mesure de Performance

```yaml
name: Tests de Performance

on:
  push:
    branches: [ main, develop ]
  pull_request:
    branches: [ main ]

jobs:
  benchmark:
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v3

      - name: Installer FreePascal
        run: |
          sudo apt-get update
          sudo apt-get install -y fpc

      - name: Compiler avec optimisations
        run: |
          cd src
          fpc -O3 -Xs MonProgramme.pas

      - name: Ex√©cuter les benchmarks
        run: |
          ./src/MonProgramme --benchmark > benchmark_results.txt
          cat benchmark_results.txt

      - name: Analyser les r√©sultats
        run: |
          # Extraire le temps d'ex√©cution
          TIME=$(grep "Temps total:" benchmark_results.txt | awk '{print $3}')
          echo "Temps d'ex√©cution: $TIME secondes"

          # Comparer avec la baseline
          BASELINE=10.0
          if (( $(echo "$TIME > $BASELINE" | bc -l) )); then
            echo "‚ö†Ô∏è Performance d√©grad√©e: $TIME s (baseline: $BASELINE s)"
            exit 1
          else
            echo "‚úÖ Performance acceptable: $TIME s"
          fi

      - name: Upload des r√©sultats
        uses: actions/upload-artifact@v3
        with:
          name: benchmark-results
          path: benchmark_results.txt

      - name: Commenter la PR avec les r√©sultats
        if: github.event_name == 'pull_request'
        uses: actions/github-script@v6
        with:
          script: |
            const fs = require('fs');
            const results = fs.readFileSync('benchmark_results.txt', 'utf8');
            github.rest.issues.createComment({
              issue_number: context.issue.number,
              owner: context.repo.owner,
              repo: context.repo.repo,
              body: `## üìä R√©sultats des Benchmarks\n\`\`\`\n${results}\n\`\`\``
            });
```

---

## Analyse de S√©curit√© et Qualit√© du Code

### Scanner de Vuln√©rabilit√©s

```yaml
name: Analyse de S√©curit√©

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]
  schedule:
    # Scan hebdomadaire le lundi √† 9h
    - cron: '0 9 * * 1'

jobs:
  security-scan:
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v3

      - name: Scanner les d√©pendances
        run: |
          # Rechercher les biblioth√®ques connues avec vuln√©rabilit√©s
          echo "Analyse des d√©pendances..."
          find . -name "*.pas" -exec grep -l "uses.*SysUtils" {} \;

      - name: Analyser le code pour les patterns dangereux
        run: |
          echo "Recherche de patterns de code dangereux..."

          # Rechercher les commandes shell potentiellement dangereuses
          if grep -r "ShellExecute\|Exec\|System(" src/; then
            echo "‚ö†Ô∏è Commandes shell d√©tect√©es - v√©rifier la s√©curit√©"
          fi

          # Rechercher les allocations m√©moire non lib√©r√©es
          if grep -r "GetMem\|New(" src/ | grep -v "FreeMem\|Dispose"; then
            echo "‚ö†Ô∏è Allocations m√©moire potentiellement non lib√©r√©es"
          fi

      - name: V√©rifier les permissions de fichiers
        run: |
          # S'assurer qu'aucun fichier ex√©cutable n'est commit√© par erreur
          find . -type f -perm /111 ! -name "*.sh" | grep -v ".git" || true
```

### Analyse de la Complexit√© du Code

```yaml
jobs:
  code-quality:
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v3

      - name: Installer les outils d'analyse
        run: |
          sudo apt-get update
          sudo apt-get install -y fpc cloc

      - name: Statistiques du code
        run: |
          echo "## üìä Statistiques du Code" > code_stats.md
          echo "" >> code_stats.md
          cloc src/ --md >> code_stats.md
          cat code_stats.md

      - name: Analyser la complexit√©
        run: |
          # Compter les fonctions longues (>100 lignes)
          echo "Recherche de fonctions trop longues..."
          for file in src/*.pas; do
            awk '/^(function|procedure)/{start=NR} /^end;/{
              if (NR-start > 100)
                print FILENAME ":" start " - Fonction trop longue (" NR-start " lignes)"
            }' "$file"
          done

      - name: V√©rifier les standards de code
        run: |
          # V√©rifier l'indentation
          echo "V√©rification de l'indentation..."
          find src/ -name "*.pas" -exec grep -n "^[^ ]" {} + | grep -v "^[^:]*:[0-9]*:(uses\|type\|var\|const\|begin\|end)" || true

      - name: Commenter la PR
        if: github.event_name == 'pull_request'
        uses: actions/github-script@v6
        with:
          script: |
            const fs = require('fs');
            const stats = fs.readFileSync('code_stats.md', 'utf8');
            github.rest.issues.createComment({
              issue_number: context.issue.number,
              owner: context.repo.owner,
              repo: context.repo.repo,
              body: stats
            });
```

---

## Documentation Automatique

### G√©n√©rer et Publier la Documentation

```yaml
name: Documentation

on:
  push:
    branches: [ main ]

jobs:
  generate-docs:
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v3

      - name: Installer PasDoc
        run: |
          sudo apt-get update
          sudo apt-get install -y pasdoc

      - name: G√©n√©rer la documentation
        run: |
          mkdir -p docs/api
          pasdoc \
            --source src/ \
            --output docs/api/ \
            --format html \
            --title "Documentation API - Mon Projet" \
            --introduction README.md

      - name: Cr√©er l'index de documentation
        run: |
          cat > docs/index.html << 'EOF'
          <!DOCTYPE html>
          <html>
          <head>
            <title>Documentation - Mon Projet FreePascal</title>
            <meta charset="UTF-8">
            <style>
              body { font-family: Arial, sans-serif; margin: 40px; }
              h1 { color: #333; }
              .link-box {
                background: #f5f5f5;
                padding: 20px;
                margin: 10px 0;
                border-radius: 5px;
              }
            </style>
          </head>
          <body>
            <h1>üìö Documentation - Mon Projet FreePascal</h1>
            <div class="link-box">
              <h2>üîó Liens Utiles</h2>
              <ul>
                <li><a href="api/">Documentation API</a></li>
                <li><a href="https://github.com/${{ github.repository }}">Code Source</a></li>
                <li><a href="https://github.com/${{ github.repository }}/releases">Releases</a></li>
              </ul>
            </div>
          </body>
          </html>
          EOF

      - name: D√©ployer sur GitHub Pages
        uses: peaceiris/actions-gh-pages@v3
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          publish_dir: ./docs
          publish_branch: gh-pages
```

**Configuration GitHub Pages :**
1. Allez dans `Settings ‚Üí Pages`
2. Source : `Deploy from a branch`
3. Branch : `gh-pages` / `root`
4. Votre documentation sera accessible √† `https://username.github.io/repo/`

---

## Gestion des Versions Automatique

### Semantic Versioning et Changelog

```yaml
name: Release Automatique

on:
  push:
    branches: [ main ]

jobs:
  release:
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v3
        with:
          fetch-depth: 0  # R√©cup√®re tout l'historique git

      - name: Analyser les commits
        id: semantic
        uses: paulhatch/semantic-version@v5.0.2
        with:
          tag_prefix: "v"
          major_pattern: "(BREAKING CHANGE|MAJOR)"
          minor_pattern: "(feat|FEATURE)"
          patch_pattern: "(fix|bugfix|patch)"
          format: "${major}.${minor}.${patch}"

      - name: G√©n√©rer le changelog
        id: changelog
        run: |
          PREVIOUS_TAG=$(git describe --tags --abbrev=0 2>/dev/null || echo "")

          if [ -z "$PREVIOUS_TAG" ]; then
            COMMITS=$(git log --pretty=format:"- %s (%h)" --no-merges)
          else
            COMMITS=$(git log ${PREVIOUS_TAG}..HEAD --pretty=format:"- %s (%h)" --no-merges)
          fi

          echo "CHANGELOG<<EOF" >> $GITHUB_OUTPUT
          echo "## Version ${{ steps.semantic.outputs.version }}" >> $GITHUB_OUTPUT
          echo "" >> $GITHUB_OUTPUT
          echo "### Changements :" >> $GITHUB_OUTPUT
          echo "$COMMITS" >> $GITHUB_OUTPUT
          echo "EOF" >> $GITHUB_OUTPUT

      - name: Compiler les binaires
        run: |
          sudo apt-get update && sudo apt-get install -y fpc
          cd src
          fpc -O3 MonProgramme.pas

      - name: Cr√©er le tag
        run: |
          git config user.name "GitHub Actions"
          git config user.email "actions@github.com"
          git tag -a "v${{ steps.semantic.outputs.version }}" -m "Release v${{ steps.semantic.outputs.version }}"
          git push origin "v${{ steps.semantic.outputs.version }}"

      - name: Cr√©er la Release GitHub
        uses: softprops/action-gh-release@v1
        with:
          tag_name: v${{ steps.semantic.outputs.version }}
          name: Release v${{ steps.semantic.outputs.version }}
          body: ${{ steps.changelog.outputs.CHANGELOG }}
          draft: false
          prerelease: false
          files: |
            src/MonProgramme
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
```

**Convention de commits pour semantic versioning :**

```
feat: Nouvelle fonctionnalit√©       ‚Üí Version mineure (1.0.0 ‚Üí 1.1.0)
fix: Correction de bug               ‚Üí Version patch (1.0.0 ‚Üí 1.0.1)
BREAKING CHANGE: Changement majeur   ‚Üí Version majeure (1.0.0 ‚Üí 2.0.0)
```

---

## Workflows R√©utilisables

### Cr√©er un Workflow R√©utilisable

**Fichier `.github/workflows/build-reusable.yml` :**

```yaml
name: Build R√©utilisable

on:
  workflow_call:
    inputs:
      os:
        required: true
        type: string
      fpc-version:
        required: false
        type: string
        default: 'latest'
      build-config:
        required: false
        type: string
        default: 'Release'
    outputs:
      artifact-name:
        description: "Nom de l'artefact cr√©√©"
        value: ${{ jobs.build.outputs.artifact }}

jobs:
  build:
    runs-on: ${{ inputs.os }}
    outputs:
      artifact: ${{ steps.upload.outputs.artifact-name }}

    steps:
      - uses: actions/checkout@v3

      - name: Installer FPC (${{ inputs.os }})
        run: |
          if [ "$RUNNER_OS" == "Linux" ]; then
            sudo apt-get update && sudo apt-get install -y fpc
          elif [ "$RUNNER_OS" == "Windows" ]; then
            choco install freepascal -y
          fi
        shell: bash

      - name: Compiler (${{ inputs.build-config }})
        run: |
          cd src
          if [ "${{ inputs.build-config }}" == "Release" ]; then
            fpc -O3 -XXs MonProgramme.pas
          else
            fpc -g -gl MonProgramme.pas
          fi
        shell: bash

      - name: Upload artefact
        id: upload
        uses: actions/upload-artifact@v3
        with:
          name: MonProgramme-${{ runner.os }}-${{ inputs.build-config }}
          path: src/MonProgramme*
```

### Utiliser le Workflow R√©utilisable

**Fichier `.github/workflows/main.yml` :**

```yaml
name: Pipeline Principal

on: [push, pull_request]

jobs:
  build-linux-debug:
    uses: ./.github/workflows/build-reusable.yml
    with:
      os: ubuntu-latest
      build-config: Debug

  build-linux-release:
    uses: ./.github/workflows/build-reusable.yml
    with:
      os: ubuntu-latest
      build-config: Release

  build-windows-release:
    uses: ./.github/workflows/build-reusable.yml
    with:
      os: windows-latest
      build-config: Release
```

**Avantages :**
- ‚úÖ √âvite la duplication de code
- ‚úÖ Maintenance centralis√©e
- ‚úÖ R√©utilisable dans plusieurs workflows

---

## Strat√©gies de Tests Avanc√©es

### Tests Param√©tr√©s avec Matrice Dynamique

```yaml
name: Tests Param√©tr√©s

on: [push, pull_request]

jobs:
  prepare-matrix:
    runs-on: ubuntu-latest
    outputs:
      matrix: ${{ steps.set-matrix.outputs.matrix }}

    steps:
      - uses: actions/checkout@v3

      - name: G√©n√©rer la matrice de test
        id: set-matrix
        run: |
          # Lire les configurations depuis un fichier JSON
          MATRIX=$(cat .github/test-matrix.json | jq -c .)
          echo "matrix=$MATRIX" >> $GITHUB_OUTPUT

  test:
    needs: prepare-matrix
    strategy:
      matrix: ${{ fromJson(needs.prepare-matrix.outputs.matrix) }}

    runs-on: ${{ matrix.os }}

    steps:
      - uses: actions/checkout@v3

      - name: Test ${{ matrix.test-name }}
        run: |
          echo "Ex√©cution du test: ${{ matrix.test-name }}"
          echo "Param√®tres: ${{ matrix.params }}"
```

**Fichier `.github/test-matrix.json` :**

```json
{
  "include": [
    {
      "os": "ubuntu-latest",
      "test-name": "Performance Tests",
      "params": "--benchmark"
    },
    {
      "os": "ubuntu-latest",
      "test-name": "Integration Tests",
      "params": "--integration"
    },
    {
      "os": "windows-latest",
      "test-name": "UI Tests",
      "params": "--ui-tests"
    }
  ]
}
```

---

## Gestion des Erreurs et Retry

### R√©essayer en Cas d'√âchec

```yaml
jobs:
  build-with-retry:
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v3

      - name: Compiler avec retry
        uses: nick-invision/retry@v2
        with:
          timeout_minutes: 10
          max_attempts: 3
          retry_wait_seconds: 30
          command: |
            sudo apt-get update
            sudo apt-get install -y fpc
            cd src
            fpc -O2 MonProgramme.pas

      - name: Tests avec retry
        uses: nick-invision/retry@v2
        with:
          timeout_minutes: 5
          max_attempts: 2
          command: |
            ./tests/run_tests.sh
```

### Continue-on-error pour les Jobs Optionnels

```yaml
jobs:
  mandatory-build:
    runs-on: ubuntu-latest
    steps:
      - name: Build principal
        run: fpc MonProgramme.pas

  optional-benchmark:
    runs-on: ubuntu-latest
    continue-on-error: true  # N'arr√™te pas le workflow si ce job √©choue
    steps:
      - name: Benchmark
        run: ./benchmark.sh

  deployment:
    needs: mandatory-build  # N'attend PAS optional-benchmark
    runs-on: ubuntu-latest
    steps:
      - name: D√©ployer
        run: ./deploy.sh
```

---

## Workflows Composites

### Cr√©er une Action Composite R√©utilisable

**Fichier `.github/actions/setup-fpc/action.yml` :**

```yaml
name: 'Setup FreePascal'
description: 'Installe FreePascal avec cache'

inputs:
  version:
    description: 'Version de FPC √† installer'
    required: false
    default: 'latest'
  cache:
    description: 'Activer le cache'
    required: false
    default: 'true'

outputs:
  fpc-version:
    description: 'Version de FPC install√©e'
    value: ${{ steps.get-version.outputs.version }}

runs:
  using: 'composite'
  steps:
    - name: Cache FPC
      if: inputs.cache == 'true'
      uses: actions/cache@v3
      with:
        path: |
          ~/.fpc
          /usr/lib/fpc
        key: ${{ runner.os }}-fpc-${{ inputs.version }}

    - name: Installer FPC (Linux)
      if: runner.os == 'Linux'
      run: sudo apt-get update && sudo apt-get install -y fpc
      shell: bash

    - name: Installer FPC (Windows)
      if: runner.os == 'Windows'
      run: choco install freepascal -y
      shell: pwsh

    - name: Obtenir la version
      id: get-version
      run: echo "version=$(fpc -iV)" >> $GITHUB_OUTPUT
      shell: bash
```

### Utiliser l'Action Composite

```yaml
jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3

      - name: Setup FreePascal
        uses: ./.github/actions/setup-fpc
        with:
          version: 'latest'
          cache: 'true'

      - name: Compiler
        run: fpc MonProgramme.pas
```

---

## Conclusion et Bonnes Pratiques Finales

### Checklist pour un Workflow de Qualit√©

‚úÖ **Organisation**
- [ ] Noms de workflows explicites
- [ ] Jobs bien s√©par√©s (build/test/deploy)
- [ ] Commentaires dans les fichiers YAML complexes

‚úÖ **Performance**
- [ ] Cache activ√© pour les d√©pendances
- [ ] Parall√©lisation des jobs ind√©pendants
- [ ] Artefacts nettoy√©s automatiquement

‚úÖ **S√©curit√©**
- [ ] Secrets utilis√©s pour les donn√©es sensibles
- [ ] Pas de secrets dans les logs
- [ ] Permissions minimales pour les tokens

‚úÖ **Qualit√©**
- [ ] Tests automatiques √† chaque commit
- [ ] Couverture de code mesur√©e
- [ ] D√©ploiement uniquement apr√®s validation

‚úÖ **Maintenance**
- [ ] Versions fix√©es pour les actions (`@v3` au lieu de `@main`)
- [ ] Documentation du workflow
- [ ] Notifications configur√©es

### Ressources Utiles

**Documentation officielle :**
- [GitHub Actions Documentation](https://docs.github.com/en/actions)
- [Marketplace GitHub Actions](https://github.com/marketplace?type=actions)
- [Awesome Actions](https://github.com/sdras/awesome-actions)

**Actions populaires pour FreePascal :**
- `actions/checkout@v3` - R√©cup√©rer le code
- `actions/upload-artifact@v3` - Sauvegarder les artefacts
- `actions/cache@v3` - Mise en cache
- `softprops/action-gh-release@v1` - Cr√©er des releases

### Exemple de Projet Complet

Pour un projet FreePascal professionnel, voici une structure recommand√©e :

```
.github/
‚îú‚îÄ‚îÄ workflows/
‚îÇ   ‚îú‚îÄ‚îÄ ci.yml              # Build et tests continus
‚îÇ   ‚îú‚îÄ‚îÄ release.yml         # Cr√©ation de releases
‚îÇ   ‚îú‚îÄ‚îÄ documentation.yml   # G√©n√©ration de docs
‚îÇ   ‚îî‚îÄ‚îÄ security.yml        # Scans de s√©curit√©
‚îú‚îÄ‚îÄ actions/
‚îÇ   ‚îî‚îÄ‚îÄ setup-fpc/          # Action composite r√©utilisable
‚îÇ       ‚îî‚îÄ‚îÄ action.yml
‚îî‚îÄ‚îÄ test-matrix.json        # Configuration des tests

src/
tests/
docs/
scripts/
```

Avec GitHub Actions, vous automatisez compl√®tement votre workflow de d√©veloppement FreePascal, du commit au d√©ploiement, sur Windows et Ubuntu en parall√®le ! üöÄ

‚è≠Ô∏è [GitLab CI avec runners multi-OS](/18-tests-qualite-code/09.2-gitlab-ci-runners-multi-os.md)
