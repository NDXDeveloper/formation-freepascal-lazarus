🔝 Retour au [Sommaire](/SOMMAIRE.md)

# 2.5.3 Alternatives à GDB (LLDB, FpDebug)

## Introduction : Pourquoi des alternatives à GDB ?

Bien que GDB soit le débogueur standard et le plus mature, il n'est pas parfait. Son âge (créé en 1986) apporte stabilité mais aussi certaines limitations. Les alternatives modernes offrent des avantages spécifiques :

**Limitations de GDB :**
- 🐌 Peut être lent sur de gros projets
- 🔧 Configuration parfois complexe
- 📚 Conçu à l'origine pour C/C++, pas Pascal
- 💾 Architecture ancienne, difficile à étendre
- 🖥️ Interface en ligne de commande native

**Les alternatives principales :**
- **FpDebug** : Conçu spécifiquement pour FreePascal
- **LLDB** : Moderne, rapide, architecture modulaire
- **Autres** : Débogueurs commerciaux ou spécialisés

## FpDebug : Le débogueur natif Pascal

### Qu'est-ce que FpDebug ?

FpDebug est un débogueur développé par l'équipe FreePascal/Lazarus, conçu dès le départ pour Object Pascal. C'est comme avoir un débogueur qui "parle Pascal nativement" plutôt qu'un débogueur C++ qui essaie de comprendre Pascal.

**Avantages majeurs :**
- 🚀 **2 à 5x plus rapide** que GDB
- 🎯 **Comprend les types Pascal** nativement
- 📦 **Intégré dans Lazarus** (pas d'installation séparée)
- 🔧 **Configuration minimale**
- 💡 **Messages d'erreur en Pascal**

**État actuel :**
```
FpDebug - Maturité :
├── ✅ Fonctionnalités de base complètes
├── ✅ Support Windows/Linux/macOS
├── ✅ Intégration Lazarus excellente
├── ⚠️  Quelques fonctions avancées manquantes
└── 🚧 Développement très actif
```

### Installation de FpDebug

#### Sur Windows

FpDebug est inclus avec Lazarus ! Aucune installation supplémentaire nécessaire.

```
Vérification :
C:\lazarus\components\fpdebug\
├── fpdebug.lpk (package)
├── fpdbgdwarffreepascal.pas
└── autres fichiers...
```

#### Sur Ubuntu/Linux

```bash
# FpDebug est inclus dans Lazarus
# Si vous avez Lazarus, vous avez FpDebug !

# Vérification
ls /usr/lib/lazarus/*/components/fpdebug/
# ou
ls ~/lazarus/components/fpdebug/
```

#### Compilation depuis les sources (optionnel)

Pour avoir la dernière version :

```bash
# Cloner Lazarus trunk
svn co https://svn.freepascal.org/svn/lazarus/trunk lazarus-trunk

# FpDebug est dans
cd lazarus-trunk/components/fpdebug

# Recompiler Lazarus avec FpDebug
make clean all
```

### Configuration de FpDebug dans Lazarus

#### Activation de FpDebug

**Menu : Outils → Options → Débogueur**

```
┌─ Configuration du Débogueur ────────────────────┐
│ Type de débogueur : [FpDebug (NEW)         ▼]   │
│                     ├── GNU debugger (gdb)      │
│                     ├── FpDebug (NEW)           │
│                     ├── FpDebug+GDB             │
│                     └── LLDB debugger           │
│                                                 │
│ État : ✓ FpDebug intégré détecté                │
│                                                 │
│ [Appliquer] [OK]                                │
└─────────────────────────────────────────────────┘
```

#### Options spécifiques FpDebug

```
Options FpDebug :
├── Général
│   ├── ☑ Arrêter sur exceptions Pascal
│   ├── ☑ Évaluation des propriétés
│   └── ☑ Support des threads
├── Affichage
│   ├── Longueur max chaînes : [10000]
│   ├── Longueur max tableaux : [1000]
│   └── Profondeur max objets : [50]
└── Avancé
    ├── ☐ Mode verbose (debug du débogueur)
    └── ☑ Cache des symboles
```

### Utilisation de FpDebug

#### Interface identique à GDB

La beauté de FpDebug est que l'interface dans Lazarus reste identique :

```
Raccourcis identiques :
├── F5 : Toggle breakpoint
├── F7 : Step into
├── F8 : Step over
├── F9 : Run/Continue
└── Ctrl+F2 : Stop
```

#### Différences notables avec GDB

**1. Affichage des strings Pascal**

```pascal
var
  S: string;
  AS: AnsiString;
  SS: ShortString;
```

- **GDB** : Affiche `{data = 0x1234, length = 5}`
- **FpDebug** : Affiche directement `'Hello'` ✨

**2. Tableaux dynamiques**

```pascal
var
  Arr: array of Integer;
```

- **GDB** : Structure complexe difficile à lire
- **FpDebug** : Affiche `[1, 2, 3, 4, 5]` directement

**3. Propriétés d'objets**

```pascal
property Count: Integer read FCount;
```

- **GDB** : Ne peut pas évaluer les propriétés
- **FpDebug** : Évalue les propriétés avec leurs getters

#### Expressions de watch améliorées

FpDebug comprend mieux les expressions Pascal :

```pascal
// Expressions supportées par FpDebug
Watch : MyObject.Items[i].SubItems[j].Text
Watch : Length(MyArray)
Watch : High(MyEnum)
Watch : Assigned(MyPointer)
Watch : MySet * [seOption1, seOption2]
```

### Avantages et limitations de FpDebug

#### Points forts

```
Avantages FpDebug :
├── 🚀 Performance
│   ├── Démarrage 3x plus rapide
│   ├── Step over instantané
│   └── Évaluation rapide des expressions
├── 🎯 Support Pascal natif
│   ├── Types Pascal compris nativement
│   ├── Strings affichées correctement
│   └── Sets, enums, variants supportés
├── 🔧 Simplicité
│   ├── Pas de configuration externe
│   ├── Pas de problèmes de version
│   └── Messages d'erreur clairs
└── 📦 Intégration
    ├── Partie de Lazarus
    ├── Évolue avec le langage
    └── Support prioritaire
```

#### Limitations actuelles

```
Limitations FpDebug (2024) :
├── ⚠️ Fonctionnalités manquantes
│   ├── Reverse debugging
│   ├── Core dumps limités
│   └── Remote debugging basique
├── 📚 Documentation
│   └── Moins de ressources que GDB
├── 🔌 Interopérabilité
│   └── Code C/C++ non supporté
└── 🐛 Stabilité
    └── Quelques bugs dans cas complexes
```

### Quand utiliser FpDebug ?

**Utilisez FpDebug si :**
- ✅ Vous développez uniquement en Pascal
- ✅ Vous voulez la meilleure performance
- ✅ Vous débutez (plus simple que GDB)
- ✅ Vous avez des problèmes avec GDB

**Restez sur GDB si :**
- ❌ Vous mixez Pascal et C/C++
- ❌ Vous avez besoin de fonctions avancées
- ❌ Vous déboguez du code système
- ❌ Vous faites du remote debugging complexe

## LLDB : L'alternative moderne

### Qu'est-ce que LLDB ?

LLDB est le débogueur du projet LLVM (Low Level Virtual Machine), créé par Apple pour remplacer GDB sur macOS. C'est un débogueur moderne avec une architecture modulaire et une API riche.

**Caractéristiques principales :**
- 🍎 **Débogueur par défaut sur macOS**
- ⚡ **Architecture moderne et rapide**
- 🐍 **API Python pour scripting**
- 🔧 **Design modulaire et extensible**
- 📱 **Support iOS/Android**

### Installation de LLDB

#### Sur Windows

LLDB sur Windows est encore expérimental :

```powershell
# Via LLVM officiel
# Télécharger depuis : https://releases.llvm.org/
# Installer LLVM-<version>-win64.exe

# Vérification
lldb --version
```

**⚠️ Note** : Support Windows limité, pas recommandé pour production.

#### Sur Ubuntu/Linux

```bash
# Installation standard
sudo apt update
sudo apt install lldb

# Version spécifique
sudo apt install lldb-14  # ou lldb-15, lldb-16

# Vérification
lldb --version
# lldb version 14.0.0

# Installation complète avec outils
sudo apt install lldb llvm clang
```

#### Sur macOS

LLDB est inclus avec Xcode :

```bash
# Si Xcode installé
xcode-select --install

# Vérification
lldb --version

# Via Homebrew (alternative)
brew install llvm
```

### Configuration de LLDB dans Lazarus

#### Activation de LLDB

**Menu : Outils → Options → Débogueur**

```
┌─ Configuration LLDB ─────────────────────────────┐
│ Type de débogueur : [LLDB debugger         ▼]    │
│                                                  │
│ Chemin vers lldb :                               │
│ [/usr/bin/lldb                              ]    │
│ [Parcourir...]                                   │
│                                                  │
│ ⚠️ Support LLDB expérimental                     │
│ Certaines fonctionnalités peuvent ne pas         │
│ fonctionner correctement avec Pascal.            │
│                                                  │
│ [OK] [Annuler]                                   │
└──────────────────────────────────────────────────┘
```

#### Configuration spécifique LLDB

```
Options LLDB :
├── Général
│   ├── ☑ Utiliser lldb-mi (interface MI)
│   ├── Timeout : [20] secondes
│   └── ☐ Mode verbose
├── Chemins
│   ├── Framework dir : [/usr/lib/lldb]
│   └── Python dir : [/usr/lib/python3]
└── Compatibilité
    ├── ☐ Mode GDB-compatible
    └── ☑ Traduire commandes GDB
```

### Utilisation de LLDB

#### Commandes de base LLDB

LLDB utilise des commandes différentes de GDB :

| Action | GDB | LLDB |
|--------|-----|------|
| Lancer | `run` | `process launch` ou `run` |
| Breakpoint | `break main` | `breakpoint set --name main` |
| Continuer | `continue` | `process continue` ou `c` |
| Step over | `next` | `thread step-over` ou `n` |
| Step into | `step` | `thread step-in` ou `s` |
| Backtrace | `bt` | `thread backtrace` ou `bt` |
| Variables | `info locals` | `frame variable` |
| Quitter | `quit` | `quit` |

#### Configuration .lldbinit

Créez `~/.lldbinit` pour personnaliser :

```python
# ~/.lldbinit
# Alias pour compatibilité GDB
command alias gdb-break breakpoint set --name
command alias gdb-info frame variable

# Settings
settings set target.load-script-from-symbol-file true
settings set target.max-string-summary-length 1024
settings set target.max-memory-read-size 1024

# Format d'affichage
settings set frame-format "frame #${frame.index}: ${frame.pc}{ ${module.file.basename}`${function.name}}{ at ${line.file.fullpath}:${line.number}}\n"

# Auto-import de scripts Python
command script import ~/lldb_scripts/pascal_helpers.py
```

#### Script Python pour Pascal

Créez `~/lldb_scripts/pascal_helpers.py` :

```python
import lldb

def pascal_string_summary(valobj, internal_dict):
    """Affiche les strings Pascal correctement"""
    try:
        length = valobj.GetChildMemberWithName('length').GetValueAsUnsigned()
        data = valobj.GetChildMemberWithName('data')
        if data.IsValid() and length > 0:
            error = lldb.SBError()
            string_data = data.GetProcess().ReadMemory(
                data.GetValueAsUnsigned(), length, error)
            if error.Success():
                return '"%s"' % string_data.decode('utf-8')
    except:
        pass
    return None

def __lldb_init_module(debugger, internal_dict):
    debugger.HandleCommand(
        'type summary add -F pascal_helpers.pascal_string_summary "^string$"'
    )
```

### Avantages et limitations de LLDB

#### Points forts

```
Avantages LLDB :
├── 🍎 macOS
│   ├── Débogueur natif
│   ├── Intégration Xcode
│   └── Support complet
├── ⚡ Performance
│   ├── Architecture moderne
│   ├── Multi-thread efficace
│   └── Chargement rapide
├── 🐍 Extensibilité
│   ├── API Python complète
│   ├── Scripting puissant
│   └── Plugins possibles
└── 🔧 Architecture
    ├── Code modulaire
    ├── API stable
    └── Réutilisable
```

#### Limitations pour Pascal

```
Limitations LLDB avec Pascal :
├── ❌ Support Pascal basique
│   ├── Types Pascal mal compris
│   ├── Strings pas affichées correctement
│   └── Propriétés non supportées
├── 📚 Documentation Pascal
│   └── Quasi inexistante
├── 🪟 Windows
│   └── Support expérimental
└── 🔌 Intégration Lazarus
    └── Basique, beaucoup de limitations
```

### Quand utiliser LLDB ?

**Utilisez LLDB si :**
- 🍎 Vous développez sur macOS
- 🐍 Vous maîtrisez Python pour l'étendre
- ⚡ Vous avez besoin de performance maximale
- 🔬 Vous déboguez du code LLVM/Clang

**Évitez LLDB si :**
- ❌ Vous développez principalement en Pascal
- ❌ Vous êtes sur Windows
- ❌ Vous débutez en débogage
- ❌ Vous avez besoin du support Pascal complet

## Comparaison détaillée

### Tableau comparatif complet

| Critère | GDB | FpDebug | LLDB |
|---------|-----|---------|------|
| **Maturité** | ⭐⭐⭐⭐⭐ | ⭐⭐⭐ | ⭐⭐⭐⭐ |
| **Support Pascal** | ⭐⭐⭐⭐ | ⭐⭐⭐⭐⭐ | ⭐⭐ |
| **Performance** | ⭐⭐⭐ | ⭐⭐⭐⭐⭐ | ⭐⭐⭐⭐ |
| **Windows** | ⭐⭐⭐⭐ | ⭐⭐⭐⭐⭐ | ⭐ |
| **Linux** | ⭐⭐⭐⭐⭐ | ⭐⭐⭐⭐ | ⭐⭐⭐ |
| **macOS** | ⭐⭐⭐ | ⭐⭐⭐ | ⭐⭐⭐⭐⭐ |
| **Configuration** | ⭐⭐ | ⭐⭐⭐⭐⭐ | ⭐⭐⭐ |
| **Documentation** | ⭐⭐⭐⭐⭐ | ⭐⭐ | ⭐⭐⭐⭐ |
| **Fonctionnalités** | ⭐⭐⭐⭐⭐ | ⭐⭐⭐ | ⭐⭐⭐⭐ |
| **Intégration Lazarus** | ⭐⭐⭐⭐⭐ | ⭐⭐⭐⭐⭐ | ⭐⭐ |

### Performance comparative

Test sur un projet de 100,000 lignes Pascal :

```
Opération           | GDB    | FpDebug | LLDB
--------------------|--------|---------|-------
Démarrage           | 3.2s   | 0.8s    | 1.5s
Premier breakpoint  | 1.5s   | 0.3s    | 0.8s
Step over           | 120ms  | 15ms    | 50ms
Évaluation variable | 80ms   | 10ms    | 40ms
Affichage tableau   | 500ms  | 50ms    | 200ms
Utilisation RAM     | 250MB  | 80MB    | 150MB
```

### Fonctionnalités supportées

```
Fonctionnalité         | GDB | FpDebug | LLDB
-----------------------|-----|---------|------
Breakpoints            | ✅  | ✅      | ✅
Conditional breaks     | ✅  | ✅      | ✅
Watchpoints           | ✅  | ⚠️      | ✅
Step in/over/out      | ✅  | ✅      | ✅
Variables locales     | ✅  | ✅      | ✅
Expressions Pascal    | ⚠️  | ✅      | ❌
Propriétés objets     | ❌  | ✅      | ❌
Threads               | ✅  | ✅      | ✅
Remote debugging      | ✅  | ⚠️      | ✅
Core dumps            | ✅  | ⚠️      | ✅
Reverse debugging     | ✅  | ❌      | ⚠️
Scripts/Automation    | ✅  | ❌      | ✅
```

## Migration entre débogueurs

### De GDB vers FpDebug

**Migration simple :**
1. Outils → Options → Débogueur
2. Changer le type vers FpDebug
3. Aucune autre modification nécessaire !

**Points d'attention :**
```
Vérifications post-migration :
☐ Tester tous les breakpoints
☐ Vérifier l'affichage des strings
☐ Tester l'évaluation d'expressions
☐ Vérifier le débogage multi-thread
```

### De GDB vers LLDB

**Migration plus complexe :**

1. **Installer LLDB**
2. **Configurer dans Lazarus**
3. **Adapter les commandes personnalisées**

```bash
# Convertir .gdbinit en .lldbinit
# GDB:
break main
run
print myvar

# LLDB:
breakpoint set --name main
process launch
frame variable myvar
```

4. **Tester intensivement** (support Pascal limité)

## Autres alternatives

### Débogueurs commerciaux

```
Alternatives commerciales :
├── Intel VTune Profiler
│   ├── Excellent pour optimisation
│   └── Cher, complexe
├── TotalView
│   ├── Débogage parallèle/HPC
│   └── Très cher
└── Windows : WinDbg
    ├── Débogueur système Microsoft
    └── Gratuit, puissant, complexe
```

### Débogueurs spécialisés

```
Débogueurs spécialisés :
├── Valgrind (Linux)
│   ├── Fuites mémoire
│   └── Pas un vrai débogueur
├── rr (Record & Replay)
│   ├── Enregistre l'exécution
│   └── Linux uniquement
└── UDB (Undo Debugger)
    ├── Time-travel debugging
    └── Commercial
```

## Configuration hybride

### FpDebug + GDB

Lazarus permet d'utiliser FpDebug avec GDB comme backend :

```
Configuration hybride :
├── Type : FpDebug+GDB
├── Avantages :
│   ├── Interface FpDebug (rapide)
│   ├── Backend GDB (complet)
│   └── Meilleur des deux mondes
└── Inconvénients :
    ├── Plus complexe
    └── Peut avoir des bugs
```

**Configuration :**
```
Outils → Options → Débogueur
Type : [FpDebug + GDB        ▼]

Options :
├── ☑ Utiliser FpDebug pour l'interface
├── ☑ GDB pour les fonctions avancées
└── ☑ Fallback automatique sur GDB
```

## Guide de décision

### Arbre de décision

```
Quel débogueur choisir ?
│
├── Développement Pascal uniquement ?
│   ├── Oui → FpDebug (rapide, simple)
│   └── Non → GDB (universel)
│
├── Sur macOS principalement ?
│   ├── Oui → LLDB (natif)
│   └── Non → Continuer
│
├── Besoin de fonctions avancées ?
│   ├── Remote debug → GDB
│   ├── Core dumps → GDB
│   ├── Reverse debug → GDB
│   └── Non → FpDebug
│
├── Débutant ?
│   ├── Oui → FpDebug (plus simple)
│   └── Non → Au choix
│
└── Performance critique ?
    ├── Oui → FpDebug
    └── Non → GDB (plus de fonctions)
```

### Recommandations par profil

#### Débutant en Pascal

```
Configuration recommandée :
├── Débogueur : FpDebug
├── Raisons :
│   ├── Configuration zéro
│   ├── Messages clairs
│   └── Rapide
└── Limitation acceptable :
    └── Fonctions avancées non nécessaires
```

#### Développeur expérimenté

```
Configuration recommandée :
├── Principal : GDB
├── Secondaire : FpDebug pour tests rapides
├── Raisons :
│   ├── Toutes fonctionnalités
│   ├── Documentation complète
│   └── Scriptable
```

#### Développeur macOS

```
Configuration recommandée :
├── Débogueur : LLDB
├── Fallback : FpDebug
├── Raisons :
│   ├── LLDB natif sur macOS
│   └── Meilleure intégration système
```

## Configuration multi-débogueur

### Profils de débogueur

Créez différents modes de build avec différents débogueurs :

```
Projet → Options → Modes de compilation
├── Debug-FpDebug
│   └── Débogueur : FpDebug
├── Debug-GDB
│   └── Débogueur : GDB
└── Debug-LLDB
    └── Débogueur : LLDB
```

### Scripts de basculement

#### Windows (batch)

```batch
@echo off
REM switch_debugger.bat

echo Sélectionnez le débogueur :
echo 1. FpDebug (rapide)
echo 2. GDB (complet)
echo 3. LLDB (expérimental)

set /p choice=Votre choix :

if %choice%==1 (
    lazarus --set-debugger=fpdebug
) else if %choice%==2 (
    lazarus --set-debugger=gdb
) else if %choice%==3 (
    lazarus --set-debugger=lldb
)
```

#### Linux (bash)

```bash
#!/bin/bash
# switch_debugger.sh

echo "Sélectionnez le débogueur :"
select debugger in "FpDebug" "GDB" "LLDB" "Quit"; do
    case $debugger in
        FpDebug)
            lazarus --primary-config-path=~/.lazarus-fpdebug
            break;;
        GDB)
            lazarus --primary-config-path=~/.lazarus-gdb
            break;;
        LLDB)
            lazarus --primary-config-path=~/.lazarus-lldb
            break;;
        Quit)
            exit;;
    esac
done
```

## Dépannage des alternatives

### FpDebug ne fonctionne pas

**Symptômes et solutions :**

```
Problème : "FpDebug not available"
├── Vérifier le package fpdebug installé
├── Recompiler Lazarus
└── Vérifier la version (>= 2.0 requis)

Problème : Variables non affichées
├── Vérifier symboles debug (-g)
├── Désactiver optimisations (-O-)
└── Mode Debug activé

Problème : Crash au démarrage
├── Conflit avec antivirus
├── Permissions insuffisantes
└── Corrompre → réinstaller
```

### LLDB ne trouve pas les symboles

**Solutions :**

```bash
# Vérifier le format des symboles
file ./mon_programme
# Doit montrer : DWARF

# Forcer DWARF dans Lazarus
Projet → Options → Debugging
└── Type : Dwarf (-gw)

# Dans LLDB
(lldb) settings set target.source-map /build/path /actual/path
```

## Tests de validation

### Test FpDebug

```pascal
program TestFpDebug;
{$mode objfpc}{$H+}

uses SysUtils, Classes;

type
  TPerson = class
  private
    FName: string;
    FAge: Integer;
  public
    property Name: string read FName write FName;
    property Age: Integer read FAge write FAge;
  end;

var
  Person: TPerson;
  List: TStringList;
  Arr: array of Integer;
  S: string;

begin
  // Test strings
  S := 'Test FpDebug';
  WriteLn(S);  // Breakpoint ici - vérifier affichage string

  // Test objets et propriétés
  Person := TPerson.Create;
  Person.Name := 'Alice';
  Person.Age := 25;  // Vérifier propriétés

  // Test tableaux dynamiques
  SetLength(Arr, 5);
  Arr[0] := 10;  // Vérifier affichage tableau

  // Test collections
  List := TStringList.Create;
  List.Add('Item 1');

  WriteLn('Tests terminés');

  List.Free;
  Person.Free;
end.
```

### Test LLDB

```pascal
program TestLLDB;
{$mode objfpc}{$H+}

begin
  WriteLn('Test LLDB - Point 1');  // break 1
  WriteLn('Test LLDB - Point 2');  // break 2
  WriteLn('Test LLDB - Point 3');  // break 3
end.
```

Commands LLDB :
```bash
lldb ./TestLLDB
(lldb) b TestLLDB.pas:5
(lldb) run
(lldb) continue
(lldb) quit
```

## Conclusion

Le choix du débogueur dépend de vos besoins spécifiques :

**FpDebug** est l'avenir du débogage Pascal :
- 🚀 Plus rapide
- 🎯 Conçu pour Pascal
- 🔧 Simple à utiliser
- 📈 En amélioration constante

**GDB** reste le choix sûr :
- 🏛️ Mature et stable
- 📚 Documentation complète
- 🔧 Toutes fonctionnalités
- 🌍 Universel

**LLDB** pour cas spécifiques :
- 🍎 Développement macOS
- 🐍 Si vous maîtrisez Python
- 🔬 Projets LLVM/Clang

**Recommandation finale :**
> Commencez avec FpDebug pour sa simplicité et sa vitesse. Si vous rencontrez des limitations, basculez sur GDB. Gardez LLDB pour macOS ou besoins spécifiques.

L'avantage de Lazarus est de pouvoir changer de débogueur facilement, permettant d'utiliser le meilleur outil pour chaque situation.

⏭️ [Intégration avec les systèmes de contrôle de version](/02-maitrise-ide-lazarus/06-integration-controle-version.md)
